<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Mel&#39;s Labs</title>
<link>https://mbacou.com/</link>
<atom:link href="https://mbacou.com/index.xml" rel="self" type="application/rss+xml"/>
<description>Playground for consulting and data science projects</description>
<image>
<url>https://mbacou.com/www/favicon.png</url>
<title>Mel&#39;s Labs</title>
<link>https://mbacou.com/</link>
<height>100</height>
<width>100</width>
</image>
<generator>quarto-1.6.1</generator>
<lastBuildDate>Sat, 30 Sep 2023 23:00:00 GMT</lastBuildDate>
<item>
  <title>Migrating this Blog from Distill to Quarto Publishing Framework</title>
  <dc:creator>Melanie BACOU</dc:creator>
  <link>https://mbacou.com/posts/2022-12-01-theme/</link>
  <description><![CDATA[ 





<div class="cell mb-4 page-columns page-full">
<div class="cell-output-display column-page">
<div id="htmlwidget-0d831ec464044459a5ef" style="width:100%;height:15rem;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-0d831ec464044459a5ef">{"x":{"options":{"maxZoom":12,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://proxy.nakarte.me/http/88.99.52.155/tmg/{z}/{x}/{y}",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"sovietmap.com"}]},{"method":"addMarkers","args":[41.14426475811268,-8.65406047010657,null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},null,null,null,null,"Me, as I'm writing this post. Read on, tips below!",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"1rem","textOnly":false,"className":"","sticky":true},null]}],"limits":{"lat":[41.14426475811268,41.14426475811268],"lng":[-8.65406047010657,-8.65406047010657]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>With the release of <strong>Quarto 1.4</strong>, markdown-based publishing is gaining popularity, way beyond the scientific community. Multilingual text-based documents (such as <strong>Rmarkdown</strong> and <strong>Jupyter</strong> notebooks) that combine executable code chunks with formatted prose greatly simplify the process of drafting, iterating, generating, documenting, sharing and reproducing computable research experiments.</p>
<p>Old-time researchers and engineers have long used <strong>Emacs <code>Org-Mode</code></strong><sup>1</sup> along with its wild hordes of keyboard shortcuts<sup>2</sup> to achieve similar results thanks to <em>Eric Schulte</em>’s incredible <strong>babel</strong> extension to <code>Org-Mode</code> <span class="citation" data-cites="schulte2012">(see Schulte et al. 2012)</span> and to <em>John MacFarlane</em>’s <a href="https://pandoc.org/">Pandoc</a> document converter library – but nowadays Quarto makes use of more efficient parsers and runtime engines (Sass, Deno) and adds in-browser real-time rendering of documents.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;For folks born in this century, to <strong>babel</strong> (<em>elips</em>) or to <strong>sweave</strong> (<em>R</em>) is the process of compiling text documents that include both static markup and executable scripts.</p>
<p><img src="https://mbacou.com/posts/2022-12-01-theme/Donald-Knuth.jpg" class="img-rounded img-fluid" style="width:10em"></p>
<p>The concept of <strong>Literate programming</strong> was introduced in 1984 by the mathematician <a href="https://en.wikipedia.org/wiki/Donald_Knuth">Donald Knuth</a> and was widely popularized thereafter in the engineering community thanks to <a href="https://orgmode.org/worg/org-contrib/babel/uses.html">org-mode</a> in the Emacs editor.</p>
<p><img src="https://mbacou.com/posts/2022-12-01-theme/Carsten-Dominik.jpg" class="img-rounded img-fluid" style="width:10em"></p>
<p>Emacs <strong><code>Org-Mode</code></strong> was created by the astronomer <a href="https://en.wikipedia.org/wiki/Org-mode#:~:text=Org%20Mode%20was%20created%20by,mode%20by%20default%20since%202006">Carsten Dominik</a> in 2003 and remains to this day one of the most used and madly loved note-taking and GTD (Get-Things-Done) tools, with many of its functionality (agenda, tags, etc.) yet to be ported to any markdown engine.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;Only keyboard, Baby!</p>
<p><a href="real-programmers.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://mbacou.com/posts/2022-12-01-theme/real-programmers.png" class="img-fluid"></a></p></div></div><p>As I am migrating my old blog posts to the new Quarto markdown syntax, this post briefly outlines my process for creating a custom Bootstrap theme for this revamped website. Feel free to reuse my <code>theme.scss</code> Sass file and tidbits.</p>
<section id="css-grid-system" class="level1 page-columns page-full">
<h1>CSS Grid System</h1>
<p>One of the many great features of Quarto is that the framework uses the full flexibility of Bootstrap v5.3 grid system, with a few handy classes to help precisely position content on a page, in particular:</p>
<ul>
<li>2 predefined (column-based) page layouts:
<ul>
<li><code>page-layout: article</code> (this document), and</li>
<li><code>page-layout: full</code></li>
</ul></li>
<li>6 column classes to control content width (shown below)</li>
<li>2 margin classes to shift content into the left or right column (like that XKCD comics):
<ul>
<li><code>&lt;div class="column-margin"&gt;</code>, and</li>
<li><code>&lt;span class="aside"&gt;</code></li>
</ul></li>
<li>8 classes to overflow content into the left or right margin</li>
</ul>
<p>For example I use Quarto <code>{.column-screen}</code> CSS class to place a flushed banner directly below the post header, as a way to highlight static or dynamic content<sup>3</sup>. Here is the R code chunk to achieve this, which output inside a <code>&lt;div class="column-screen"&gt;</code> element, like the map above.</p>
<div class="no-row-height column-margin column-container"><div id="fn3"><p><sup>3</sup>&nbsp;Note that, as of time of writing, this will push and collapse the TOC to the top of the page until the user scrolls past the first <code>&lt;div class="column-screen"&gt;</code> element.</p></div></div><div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb1-2"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| column: screen</span></span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">library(leaflet)</span></span>
<span id="cb1-5"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">leaflet(width="100%", height="15em") %&gt;% addTiles() %&gt;%</span></span>
<span id="cb1-6"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  addMarkers(-8.65406047010657, 41.14426475811268, </span></span>
<span id="cb1-7"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    label="Me, as I'm writing this post. Read on, tips below!", </span></span>
<span id="cb1-8"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    labelOptions=labelOptions(textsize="1rem"))</span></span>
<span id="cb1-9"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<p>There are new Quarto CSS classes to help control content width and placement.</p>
<div class="column-body striped mb-2">
<p>.column-body</p>
</div>
<div class="column-body-outset striped mb-2">
<p>.column-body-outset</p>
</div>
<div class="column-page striped mb-2">
<p>.column-page</p>
</div>
<div class="column-page-inset striped mb-2">
<p>.column-page-inset</p>
</div>
<div class="column-screen striped mb-2">
<p>.column-screen</p>
</div>
<div class="column-screen-inset striped mb-4">
<p>.column-screen-inset-shaded</p>
</div>
<p>Finally any layout is achievable using stackable <code>&lt;div class="g-col-{width}"&gt;</code> columns inside a custom <code>&lt;div class="grid"&gt;</code> element (see color boxes below). The full system summarized here, copied straight from Quarto online (awesome) documentation<sup>4</sup>.</p>
<div class="no-row-height column-margin column-container"><div id="fn4"><p><sup>4</sup>&nbsp;Refer to <a href="https://quarto.org/docs/authoring/article-layout.html#available-columns">Quarto CSS classes</a> official documentation.</p></div></div><div class="column-page-right">
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 40%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Column</th>
<th>Code Cell <code>column</code></th>
<th>Class Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Body</td>
<td><pre><code>column: body
column: body-outset
column: body-outset-left
column: body-outset-right</code></pre></td>
<td><pre><code>.column-body
.column-body-outset
.column-body-outset-left
.column-body-outset-right</code></pre></td>
</tr>
<tr class="even">
<td>Page Inset</td>
<td><pre><code>column: page-inset-left
column: page-inset-right</code></pre></td>
<td><pre><code>.column-page-inset-left
.column-page-inset-right</code></pre></td>
</tr>
<tr class="odd">
<td>Page</td>
<td><pre><code>column: page
column: page-left
column: page-right</code></pre></td>
<td><pre><code>.column-page
.column-page-left
.column-page-right</code></pre></td>
</tr>
<tr class="even">
<td>Screen Inset</td>
<td><pre><code>column: screen-inset
column: screen-inset-shaded
column: screen-inset-left
column: screen-inset-right</code></pre></td>
<td><pre><code>.column-screen-inset
.column-screen-inset-shaded
.column-screen-inset-left
.column-screen-inset-right</code></pre></td>
</tr>
<tr class="odd">
<td>Screen</td>
<td><pre><code>column: screen
column: screen-left
column: screen-right</code></pre></td>
<td><pre><code>.column-screen
.column-screen-left
.column-screen-right</code></pre></td>
</tr>
<tr class="even">
<td>Margin</td>
<td><pre><code>column: margin</code></pre></td>
<td><pre><code>.column-margin / .aside</code></pre></td>
</tr>
</tbody>
</table>
</div>
<p>A paragraph right next to table.</p>
</section>
<section id="color-scheme" class="level1 page-columns page-full">
<h1>Color Scheme</h1>
<p>Choosing a color scheme is easy, you can start from your favorite photo or graphic and upload it to one of the many online <strong>color palette generators</strong> to extract base and accent colors. Below I have selected a standard 12-color palette that simply strives to complement my decade old <a href="https://store.kde.org/p/1980663">Kubuntu desktop</a><sup>5</sup> (in a light version). A remarkable generator I have used for many UI themes is <a href=""></a>.</p>
<div class="no-row-height column-margin column-container"><div id="fn5"><p><sup>5</sup>&nbsp;KDE, 30 years later, still going strong! <a href="https://images.pling.com/img/00/00/51/57/23/1980663/screenshot-20230201-205024.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="https://images.pling.com/img/00/00/51/57/23/1980663/screenshot-20230201-205024.png" class="img-fluid"></a></p></div></div><div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(htmltools)</span>
<span id="cb14-2"></span>
<span id="cb14-3">pal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb14-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cyan   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#789494"</span>,</span>
<span id="cb14-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">teal   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#445e64"</span>,</span>
<span id="cb14-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dark   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#222e32"</span>,</span>
<span id="cb14-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pink   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#aea39a"</span>,</span>
<span id="cb14-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">purple =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#98796f"</span>,</span>
<span id="cb14-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indigo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9b59b6"</span>,</span>
<span id="cb14-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blue   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#3daee9"</span>,</span>
<span id="cb14-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">green  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#27ae60"</span>,</span>
<span id="cb14-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yellow =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#edcd37"</span>,</span>
<span id="cb14-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orange =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f67400"</span>,</span>
<span id="cb14-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">red    =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#da4453"</span>,</span>
<span id="cb14-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">light  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#eff0f1"</span></span>
<span id="cb14-16">)</span>
<span id="cb14-17"></span>
<span id="cb14-18">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>))</span>
<span id="cb14-19"></span>
<span id="cb14-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(pal),</span>
<span id="cb14-21">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(i) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">div</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(</span>
<span id="cb14-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"g-col-"</span>, n[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" small rounded text-center p-2 bg-"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(pal)[i]), </span>
<span id="cb14-23">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">HTML</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(pal)[i], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;br/&gt;("</span>, pal[[i]], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">")"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb14-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tagList</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb14-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">div</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">class=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grid"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"--bs-gap: .5rem;"</span>)</span></code></pre></div>
<div class="grid" style="--bs-gap: .5rem;">
<div class="g-col-2 small rounded text-center p-2 bg-cyan">cyan <br>( #789494 )</div>
<div class="g-col-2 small rounded text-center p-2 bg-teal">teal <br>( #445e64 )</div>
<div class="g-col-2 small rounded text-center p-2 bg-dark">dark <br>( #222e32 )</div>
<div class="g-col-2 small rounded text-center p-2 bg-pink">pink <br>( #aea39a )</div>
<div class="g-col-2 small rounded text-center p-2 bg-purple">purple <br>( #98796f )</div>
<div class="g-col-2 small rounded text-center p-2 bg-indigo">indigo <br>( #9b59b6 )</div>
<div class="g-col-4 small rounded text-center p-2 bg-blue">blue <br>( #3daee9 )</div>
<div class="g-col-4 small rounded text-center p-2 bg-green">green <br>( #27ae60 )</div>
<div class="g-col-4 small rounded text-center p-2 bg-yellow">yellow <br>( #edcd37 )</div>
<div class="g-col-4 small rounded text-center p-2 bg-orange">orange <br>( #f67400 )</div>
<div class="g-col-4 small rounded text-center p-2 bg-red">red <br>( #da4453 )</div>
<div class="g-col-4 small rounded text-center p-2 bg-light">light <br>( #eff0f1 )</div>
</div>
</section>
<section id="block-elements" class="level1">
<h1>Block Elements</h1>
<p>Simple indented blockquote with (small) source.</p>
<blockquote class="blockquote">
<p>Blockquote title<br>
Blockquote content comes here…<br>
<small>– And small description</small></p>
</blockquote>
<p>Bootstrap built-in <strong>callout blocks</strong> and <strong>cards</strong> components are readily available in Quarto markdown with the usual semantic colors.</p>
<div class="callout callout-style-simple callout-none no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>Note that there are 6 types of callout blocks, including: <code>default</code>, <code>note</code>, <code>warning</code>, <code>important</code>, <code>tip</code>, and <code>caution</code>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a note.</p>
</div>
</div>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1">::: {.callout-tip}</span>
<span id="cb15-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">### Callout title</span></span>
<span id="cb15-3">This is an example of a callout with a title.</span>
<span id="cb15-4">:::</span></code></pre></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Callout title
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is an example of a callout with a title.</p>
</div>
</div>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb16-1">::: {.callout-caution collapse="true"}</span>
<span id="cb16-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">### Expand to learn about collapse</span></span>
<span id="cb16-3">This is an example of a 'folded' caution callout</span>
<span id="cb16-4">:::</span></code></pre></div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expand to learn about collapse
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This is an example of a “folded” caution callout that can be expanded by the user. You can use <code>collapse="true"</code> to collapse it by default or <code>collapse="false"</code> to make a collapsible callout that is expanded by default.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Important">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a callout with a title.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled" title="Warning">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is a callout with a title.</p>
</div>
</div>
</section>
<section id="typography" class="level1 page-columns page-full">
<h1>Typography</h1>
<p>Bootstrap default line-height and font sizing typically work, but I like to enforce a strict vertical grid whenever possible, so I make sure to define all vertical spacing and padding as multiple of a standard line height of <code>spacer</code>.</p>
<div class="cell">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>./www/theme-mblabs.scss</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode sass code-with-copy"><code class="sourceCode sass"><span id="cb17-1"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$spacer</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">px</span>;</span>
<span id="cb17-2"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$spacers</span>: (</span>
<span id="cb17-3">  0: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-4">  1: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$spacer</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.25</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-5">  2: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$spacer</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-6">  3: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$spacer</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-7">  4: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$spacer</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-8">  5: <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$spacer</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span></span>
<span id="cb17-9">);</span>
<span id="cb17-10"></span>
<span id="cb17-11"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$line-height-base</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.375</span>;</span>
<span id="cb17-12"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$headings-line-height</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.375</span>;</span>
<span id="cb17-13"><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$list-inline-padding</span>: <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.5</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">$spacer</span>;</span></code></pre></div>
</div>
</div>
<p>No additional changes to font definitions aside from using <code>Source Sans Pro</code>, <code>Oswald</code>, and <code>Roboto Condensed</code> fonts. This is how <strong>bold</strong>, <em>italic</em>, and <small>small</small> text look like. Here is <sup>superscript</sup> and <sub>subscript</sub> text, and <del>strikethrough</del> notes. Semantic colors with e.g.&nbsp;<span class="text-info">.text-info</span> provide accented text. I have added 2 background classes for my own use <span class="shaded"><code>.shaded</code></span> and <span class="striped"><code>.striped</code></span>. I use <span class="text-muted">.text-muted</span> for all post metadata, end and margin notes, and for captioning.</p>
<section id="heading-2" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="heading-2">Heading 2</h2>
<p>Sample paragraph content.</p>
<section id="heading-3" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="heading-3">Heading 3</h3>
<p>Sample paragraph content with list of items:</p>
<ul>
<li>List 1</li>
<li>List 2</li>
<li>List 3</li>
</ul>
<p>Ordered list:</p>
<ol>
<li>List 1<br>
</li>
<li>List 2<br>
</li>
<li>List 3</li>
</ol>
<section id="heading-4" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="heading-4">Heading 4</h4>
<p>Sample paragraph content.</p>
<blockquote class="blockquote">
<p>Blockquote title<br>
Blockquote content comes here…<br>
<small>– And small source</small></p>
</blockquote>
<p>Sample paragraph content after blockquote.</p>
<section id="heading-5" class="level5 page-columns page-full">
<h5 class="anchored" data-anchor-id="heading-5">Heading 5</h5>
<p>Sample paragraph content.</p>
<p>Here is a footnote reference<sup>6</sup> and another much longer one<sup>7</sup>. Caption and footnote placement can be controlled in the config files <code>_quarto_yml</code> and/or <code>_metadata.yml</code>, or directly in the YAML front matter.</p>
<div class="no-row-height column-margin column-container"><div id="fn6"><p><sup>6</sup>&nbsp;Here is the footnote.</p></div><div id="fn7"><p><sup>7</sup>&nbsp;Here’s one with multiple blocks.</p>
<p>With subsequent paragraphs indented to show that they belong to the previous footnote.</p></div></div></section>
</section>
</section>
</section>
</section>
<section id="tables" class="level1 page-columns page-full">
<h1>Tables</h1>
<p>I prefer my normal tables slightly more condensed than Bootstrap’s default and to resemble LaTeX typesetting, so made a few simple changes here.</p>
<table class="table">
<caption>My default table spacing</caption>
<tbody>
<tr class="odd">
<td>apple</td>
<td>2.05</td>
</tr>
<tr class="even">
<td>pear</td>
<td>1.37</td>
</tr>
<tr class="odd">
<td>orange</td>
<td>3.09</td>
</tr>
</tbody>
</table>
<table class="table-borderless table-hover table-sm small table">
<caption>borderless hover sm</caption>
<thead>
<tr class="header">
<th>fruit</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>apple</td>
<td>2.05</td>
</tr>
<tr class="even">
<td>pear</td>
<td>1.37</td>
</tr>
<tr class="odd">
<td>orange</td>
<td>3.09</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover table-sm small table">
<caption>striped hover sm</caption>
<thead>
<tr class="header">
<th>fruit</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>apple</td>
<td>2.05</td>
</tr>
<tr class="even">
<td>pear</td>
<td>1.37</td>
</tr>
<tr class="odd">
<td>orange</td>
<td>3.09</td>
</tr>
</tbody>
</table>
<table class="table-striped table-hover table-sm table-secondary small table">
<caption>striped hover sm secondary</caption>
<thead>
<tr class="header">
<th>fruit</th>
<th>price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>apple</td>
<td>2.05</td>
</tr>
<tr class="even">
<td>pear</td>
<td>1.37</td>
</tr>
<tr class="odd">
<td>orange</td>
<td>3.09</td>
</tr>
</tbody>
</table>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(mtcars[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>])</span></code></pre></div>
<div class="cell-output-display column-page">
<table class="table table-sm table-striped small">
<caption>A full-width table to increase content space</caption>
<colgroup>
<col style="width: 28%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">mpg</th>
<th style="text-align: right;">cyl</th>
<th style="text-align: right;">disp</th>
<th style="text-align: right;">hp</th>
<th style="text-align: right;">drat</th>
<th style="text-align: right;">wt</th>
<th style="text-align: right;">qsec</th>
<th style="text-align: right;">vs</th>
<th style="text-align: right;">am</th>
<th style="text-align: right;">gear</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mazda RX4</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.620</td>
<td style="text-align: right;">16.46</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Mazda RX4 Wag</td>
<td style="text-align: right;">21.0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.90</td>
<td style="text-align: right;">2.875</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Datsun 710</td>
<td style="text-align: right;">22.8</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">108</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">3.85</td>
<td style="text-align: right;">2.320</td>
<td style="text-align: right;">18.61</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hornet 4 Drive</td>
<td style="text-align: right;">21.4</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">258</td>
<td style="text-align: right;">110</td>
<td style="text-align: right;">3.08</td>
<td style="text-align: right;">3.215</td>
<td style="text-align: right;">19.44</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hornet Sportabout</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">360</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">3.15</td>
<td style="text-align: right;">3.440</td>
<td style="text-align: right;">17.02</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Valiant</td>
<td style="text-align: right;">18.1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">225</td>
<td style="text-align: right;">105</td>
<td style="text-align: right;">2.76</td>
<td style="text-align: right;">3.460</td>
<td style="text-align: right;">20.22</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="apply-themed-colors-to-r-graphics" class="level1">
<h1>Apply Themed Colors to R Graphics</h1>
<p>I make use of R <code>thematic::thematic_on()</code> package to auto-generate <code>base graphics</code>, <code>lattice</code> and <code>ggplot2</code> color palettes that match the new Bootstrap scheme.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Specify your sequential and qualitative palettes</span></span>
<span id="cb19-2">thematic<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">thematic_on</span>(</span>
<span id="cb19-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#505050"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">accent =</span> pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cyan"</span>],</span>
<span id="cb19-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_spec</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Condensed"</span>),</span>
<span id="cb19-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sequential =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sequential_gradient</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fg_weight=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg_weight=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fg_low=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>),</span>
<span id="cb19-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">qualitative =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alpha</span>(pal[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>], .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>)</span>
<span id="cb19-7">  )</span></code></pre></div>
</div>
<p>Note that calling <code>thematic_on()</code> modifies R session <code>getOption("ggplot2.discrete.colour")</code> and <code>getOption("ggplot2.discrete.fill")</code> – and that’s how the underlying “magic” happens.</p>
<p>Next I apply (slightly opinionated) changes to <code>ggthemes::theme_foundation()</code>, mostly transparent fills, condensed font, simplified axes, and a y-axis on the right side.</p>
<p>These graphic customizations are further documented in <code>./R/theme.R</code> in this repo, so as to handle dependencies, and because I want to use them more flexibly across my blog posts. Obviously when visualizing scientific and spatial datasets the choice of color scales requires good care, so the use of <code>thematic_on()</code> is often not sufficient, but it’s a good start here nonetheless.</p>
<div class="cell">
<div class="code-with-filename">
<details class="code-fold">
<summary>Show all code</summary>
<div class="code-with-filename-file">
<pre><strong>./R/theme.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Default `mblabs` 12-color palette</span></span>
<span id="cb20-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Custom named qualitative color palette with 12 hues derived from `mblabs`</span></span>
<span id="cb20-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Bootstrap theme.</span></span>
<span id="cb20-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @keywords datasets</span></span>
<span id="cb20-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @name pal</span></span>
<span id="cb20-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @format A named character vector of hex color codes</span></span>
<span id="cb20-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @examples</span></span>
<span id="cb20-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' pie(rep(1, 12), col=pal, labels=names(pal), border="white", clockwise=TRUE)</span></span>
<span id="cb20-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @export</span></span>
<span id="cb20-14">pal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb20-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cyan   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#789494"</span>,</span>
<span id="cb20-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">teal   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#445e64"</span>,</span>
<span id="cb20-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dark   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#222e32"</span>,</span>
<span id="cb20-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pink   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#aea39a"</span>,</span>
<span id="cb20-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">purple =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#98796f"</span>,</span>
<span id="cb20-20">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">indigo =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#9b59b6"</span>,</span>
<span id="cb20-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">blue   =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#3daee9"</span>,</span>
<span id="cb20-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">green  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#27ae60"</span>,</span>
<span id="cb20-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yellow =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#edcd37"</span>,</span>
<span id="cb20-24">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">orange =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f67400"</span>,</span>
<span id="cb20-25">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">red    =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#da4453"</span>,</span>
<span id="cb20-26">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">light  =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#f9f9f9"</span></span>
<span id="cb20-27">)</span>
<span id="cb20-28"></span>
<span id="cb20-29"></span>
<span id="cb20-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Color ramp based on `mblabs` theme colors</span></span>
<span id="cb20-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Default qualitative color ramp derived from `mblabs` Bootstrap theme.</span></span>
<span id="cb20-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @param x number of colors to interpolate</span></span>
<span id="cb20-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @inheritParams grDevices::colorRamp</span></span>
<span id="cb20-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @inheritDotParams grDevices::colorRamp</span></span>
<span id="cb20-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @return A function to interpolate colors</span></span>
<span id="cb20-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @examples</span></span>
<span id="cb20-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' x &lt;- rchisq(100, df=4)</span></span>
<span id="cb20-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' hist(x, freq=FALSE, ylim=c(0, 0.2), col=labs.colors(20), border="white")</span></span>
<span id="cb20-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' hist(x, freq=FALSE, ylim=c(0, 0.2), col=labs.colors(8), border="white")</span></span>
<span id="cb20-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @export</span></span>
<span id="cb20-44">labs.colors <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colors=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(pal), ...) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colorRampPalette</span>(colors, ...)(x)</span>
<span id="cb20-45"></span>
<span id="cb20-46"></span>
<span id="cb20-47"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Apply graphic color palettes</span></span>
<span id="cb20-48"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-49"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Set `mblabs` default values to `thematic::thematic_on()`, and modify</span></span>
<span id="cb20-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' `lattice` and `ggplot` color palettes and fonts.</span></span>
<span id="cb20-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @inheritParams thematic::thematic_on</span></span>
<span id="cb20-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @inheritDotParams thematic::thematic_on</span></span>
<span id="cb20-54"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @return A global graphic theme</span></span>
<span id="cb20-55"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @importFrom thematic thematic_on font_spec sequential_gradient</span></span>
<span id="cb20-56"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @importFrom scales alpha</span></span>
<span id="cb20-57"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @examples</span></span>
<span id="cb20-58"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' theme_labs_on()</span></span>
<span id="cb20-59"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' lattice::show.settings()</span></span>
<span id="cb20-60"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-61"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @export</span></span>
<span id="cb20-62">theme_labs_on <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(</span>
<span id="cb20-63">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>,</span>
<span id="cb20-64">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fg =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#505050"</span>,</span>
<span id="cb20-65">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">accent =</span> pal[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]],</span>
<span id="cb20-66">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Roboto Condensed"</span>,</span>
<span id="cb20-67">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sequential =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sequential_gradient</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fg_weight=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg_weight=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fg_low=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>),</span>
<span id="cb20-68">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">qualitative =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alpha</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs.colors</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>), .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>),</span>
<span id="cb20-69">  ...</span>
<span id="cb20-70">) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">thematic_on</span>(</span>
<span id="cb20-71">  bg, fg, accent, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_spec</span>(font), sequential, qualitative, ...)</span>
<span id="cb20-72"></span>
<span id="cb20-73"></span>
<span id="cb20-74"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Default `ggplot2` theme for `mblabs`</span></span>
<span id="cb20-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-76"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Custom `ggplot` theme for `mblabs` website.</span></span>
<span id="cb20-77"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-78"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @inheritParams ggthemes::theme_foundation</span></span>
<span id="cb20-79"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @param base_bg Plot, panel, legend background</span></span>
<span id="cb20-80"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @param base_color Color for text and line elements</span></span>
<span id="cb20-81"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @inheritDotParams ggplot2::theme</span></span>
<span id="cb20-82"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-83"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @return A custom `ggplot2` theme</span></span>
<span id="cb20-84"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @importFrom ggthemes theme_foundation</span></span>
<span id="cb20-85"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @examples</span></span>
<span id="cb20-86"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' require(ggplot2)</span></span>
<span id="cb20-87"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-88"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' ggplot(mtcars, aes(factor(carb), mpg, fill=factor(carb))) + geom_col() +</span></span>
<span id="cb20-89"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   guides(y=guide_none(), y.sec=guide_axis()) +</span></span>
<span id="cb20-90"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   labs(</span></span>
<span id="cb20-91"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'     title = "Plot with default fonts and color scheme",</span></span>
<span id="cb20-92"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'     subtitle = "My very long subtitle with many units",</span></span>
<span id="cb20-93"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'     caption = "My very long plot caption with many references.") +</span></span>
<span id="cb20-94"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'     theme_labs()</span></span>
<span id="cb20-95"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-96"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' theme_labs_on()</span></span>
<span id="cb20-97"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-98"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' ggplot(mtcars, aes(factor(carb), mpg, fill=factor(carb))) + geom_col() +</span></span>
<span id="cb20-99"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   guides(y=guide_none(), y.sec=guide_axis()) +</span></span>
<span id="cb20-100"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   labs(</span></span>
<span id="cb20-101"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'     title = "Same plot with `mblabs` font and color scheme",</span></span>
<span id="cb20-102"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'     subtitle = "My very long subtitle with many units",</span></span>
<span id="cb20-103"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'     caption = "My very long plot caption with many references.") +</span></span>
<span id="cb20-104"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'     theme_labs()</span></span>
<span id="cb20-105"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-106"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @export</span></span>
<span id="cb20-107">theme_labs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(</span>
<span id="cb20-108">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,</span>
<span id="cb20-109">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_family =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use Thematic theme,</span></span>
<span id="cb20-110">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_bg =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use Thematic theme</span></span>
<span id="cb20-111">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_color =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># use Thematic theme</span></span>
<span id="cb20-112">  ...</span>
<span id="cb20-113">) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_foundation</span>(</span>
<span id="cb20-114">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> base_size,</span>
<span id="cb20-115">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_family =</span> base_family</span>
<span id="cb20-116">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb20-117"></span>
<span id="cb20-118">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb20-119">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>base_color, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lineheight=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>),</span>
<span id="cb20-120">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>base_color),</span>
<span id="cb20-121">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">rect =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb20-122">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>base_bg, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb20-123">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>base_bg, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb20-124">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>),</span>
<span id="cb20-125">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>base_color),</span>
<span id="cb20-126">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb20-127">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb20-128">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(),</span>
<span id="cb20-129"></span>
<span id="cb20-130">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb20-131">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plain"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>base_size<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.33</span>),</span>
<span id="cb20-132">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.subtitle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb20-133">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plain"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>base_size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb20-134">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb20-135">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>base_size),</span>
<span id="cb20-136">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb20-137">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>base_size<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb20-138"></span>
<span id="cb20-139">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>base_size),</span>
<span id="cb20-140">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>base_size<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>),</span>
<span id="cb20-141">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb20-142">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>base_color, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>base_size, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">face=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb20-143">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb20-144">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>),</span>
<span id="cb20-145">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb20-146">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb20-147">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>),</span>
<span id="cb20-148">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(),</span>
<span id="cb20-149">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.line.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb20-150"></span>
<span id="cb20-151">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb20-152">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.box.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_rect</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>),</span>
<span id="cb20-153">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>base_size<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb20-154">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb20-155">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.key.size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">85</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb20-156">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>base_size<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.95</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb20-157">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.justification=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,</span>
<span id="cb20-158">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.direction=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"horizontal"</span>,</span>
<span id="cb20-159">  ...</span>
<span id="cb20-160">)</span>
<span id="cb20-161"></span>
<span id="cb20-162"></span>
<span id="cb20-163"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Default themed `ggplot` for `mblabs`</span></span>
<span id="cb20-164"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-165"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' A themed `ggplot` with custom element sizes, colors, and guides for `mblabs` website.</span></span>
<span id="cb20-166"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-167"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @inheritParams ggplot2::ggplot</span></span>
<span id="cb20-168"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @param pos_x Position of x-axis (bottom or top)</span></span>
<span id="cb20-169"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @param pos_y Position of y-axis (right or left)</span></span>
<span id="cb20-170"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @inheritDotParams theme_labs</span></span>
<span id="cb20-171"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-172"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @return A `ggplot2` object with new theme elements applied</span></span>
<span id="cb20-173"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @import ggplot2</span></span>
<span id="cb20-174"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @examples</span></span>
<span id="cb20-175"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' require(ggplot2)</span></span>
<span id="cb20-176"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' theme_labs_on()</span></span>
<span id="cb20-177"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-178"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' gglabs(mtcars, aes(factor(carb), mpg, fill=factor(carb))) + geom_col() +</span></span>
<span id="cb20-179"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   guides(y=guide_none(), y.sec=guide_axis()) +</span></span>
<span id="cb20-180"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   labs(</span></span>
<span id="cb20-181"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'     title = "My Long and Descriptive Plot Title",</span></span>
<span id="cb20-182"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'     subtitle = "My very long subtitle with many units",</span></span>
<span id="cb20-183"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'     caption = "My very long plot caption with many references.")</span></span>
<span id="cb20-184"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-185"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' gglabs(mtcars, aes(wt, mpg, color=carb)) +</span></span>
<span id="cb20-186"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   geom_point() + geom_smooth() +</span></span>
<span id="cb20-187"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   labs(</span></span>
<span id="cb20-188"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   title = "My Title",</span></span>
<span id="cb20-189"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   subtitle = "My Subtitle",</span></span>
<span id="cb20-190"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   caption = "My plot caption")</span></span>
<span id="cb20-191"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-192"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' gglabs(mtcars, aes(wt, mpg, color=factor(cyl))) +</span></span>
<span id="cb20-193"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   geom_point() +</span></span>
<span id="cb20-194"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   labs(</span></span>
<span id="cb20-195"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   title = "My Title",</span></span>
<span id="cb20-196"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   subtitle = "My Subtitle",</span></span>
<span id="cb20-197"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'   caption = "My plot caption")</span></span>
<span id="cb20-198"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb20-199"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @export</span></span>
<span id="cb20-200">gglabs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(</span>
<span id="cb20-201">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb20-202">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mapping =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(),</span>
<span id="cb20-203">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos_x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>),</span>
<span id="cb20-204">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pos_y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>),</span>
<span id="cb20-205">  ...) {</span>
<span id="cb20-206"></span>
<span id="cb20-207">  pos_x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match.arg</span>(pos_x)</span>
<span id="cb20-208">  pos_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">match.arg</span>(pos_y)</span>
<span id="cb20-209"></span>
<span id="cb20-210">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(data, mapping</span>
<span id="cb20-211">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(</span>
<span id="cb20-212">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(pos_x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_none</span>() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_axis</span>(),</span>
<span id="cb20-213">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x.sec =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(pos_x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_none</span>() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_axis</span>(),</span>
<span id="cb20-214">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(pos_y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"right"</span>) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_none</span>() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_axis</span>(),</span>
<span id="cb20-215">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y.sec =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(pos_y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span>) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_none</span>() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_axis</span>()</span>
<span id="cb20-216"></span>
<span id="cb20-217">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_labs</span>(...)</span>
<span id="cb20-218">}</span></code></pre></div>
</details>
</div>
</div>
<p>Let’s generate a couple of categorical and continuous <code>ggplot</code> and <code>lattice</code> charts below to make sure everything looks adequate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apply and check my new graphic theme</span></span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mblabs)</span>
<span id="cb21-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb21-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_labs_on</span>()</span></code></pre></div>
</div>
<div class="cell preview-image">
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mtcars, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(carb), mpg, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(carb))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_none</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y.sec=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_axis</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb22-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My Long and Descriptive Plot Title"</span>, </span>
<span id="cb22-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My very long subtitle with many units"</span>, </span>
<span id="cb22-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My very long plot caption with many references."</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_labs</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://mbacou.com/posts/2022-12-01-theme/index_files/figure-html/unnamed-chunk-8-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(mtcars, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(wt, mpg, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>carb)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb23-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guides</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_none</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y.sec=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">guide_axis</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb23-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My Long and Descriptive Plot Title"</span>, </span>
<span id="cb23-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My very long subtitle with many units"</span>, </span>
<span id="cb23-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My very long plot caption with many references."</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_labs</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://mbacou.com/posts/2022-12-01-theme/index_files/figure-html/unnamed-chunk-9-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note that the code chunk below produces a PNG instead of SVG file. I also set <code>knitr</code> option globally <code>fig-dpi: 220</code> so plots still look decent when printed to paper (though of course it’s not adequate on long pages with many plots).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb24-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{r}</span></span>
<span id="cb24-2"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#| fig-format: png</span></span>
<span id="cb24-3"></span>
<span id="cb24-4"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">gglabs(faithfuld, aes(waiting, eruptions, z=density)) +</span></span>
<span id="cb24-5"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  geom_raster(aes(fill=density)) +</span></span>
<span id="cb24-6"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  geom_contour()</span></span>
<span id="cb24-7"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://mbacou.com/posts/2022-12-01-theme/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gglabs</span>(mtcars, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(wt, mpg, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(cyl))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My Title"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My Subtitle"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"My plot caption"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://mbacou.com/posts/2022-12-01-theme/index_files/figure-html/unnamed-chunk-11-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Note that <code>thematic_on()</code> also does a little magic with R base graphics <code>par()</code> options. This is important as many advanced statistical and spatial libraries in R continue to make use of R base <code>graphics</code> library.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1">lattice<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">show.settings</span>()</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://mbacou.com/posts/2022-12-01-theme/index_files/figure-html/unnamed-chunk-12-1.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rchisq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb27-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">freq=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb27-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)</span>
<span id="cb27-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">curve</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dchisq</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://mbacou.com/posts/2022-12-01-theme/index_files/figure-html/unnamed-chunk-12-2.svg" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>



</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-schulte2012" class="csl-entry">
Schulte, Eric, Dan Davison, Thomas Dye, and Carsten Dominik. 2012. <span>“A Multi-Language Computing Environment for Literate Programming and Reproducible Research.”</span> <em>Journal of Statistical Software</em> 46 (3): 1–24. <a href="https://doi.org/10.18637/jss.v046.i03">https://doi.org/10.18637/jss.v046.i03</a>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bacou2023,
  author = {BACOU, Melanie},
  title = {Migrating This {Blog} from {*Distill*} to {*Quarto*}
    {Publishing} {Framework}},
  date = {2023-10-01},
  url = {https://mbacou.com/posts/2022-12-01-theme/},
  langid = {en},
  abstract = {A post about literate programming in general and Quarto
    formats in particular to document migrating this personal blog from
    {[}Distill{]}(https://rstudio.github.io/distill/) to
    {[}Quarto{]}(https://quarto.org/). Compared with *J.J. Allaire’s
    Distill for R Markdown*, **Posit® Quarto Markdown** uses a new
    templating system built on top of {[}Bootstrap
    v5.3.1{]}(https://getbootstrap.com/docs/5.3/customize/overview/)
    with new page layouts, extended export formats, and more flexible
    publishing workflows. This post briefly outlines my process for
    creating a custom theme for this Quarto-generated website, as well
    as design tweaks I have made along the way.}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bacou2023" class="csl-entry quarto-appendix-citeas">
BACOU, Melanie. 2023. <span>“Migrating This Blog from *Distill* to
*Quarto* Publishing Framework.”</span> October 1, 2023. <a href="https://mbacou.com/posts/2022-12-01-theme/">https://mbacou.com/posts/2022-12-01-theme/</a>.
</div></div></section></div> ]]></description>
  <category>quarto</category>
  <category>dataviz</category>
  <guid>https://mbacou.com/posts/2022-12-01-theme/</guid>
  <pubDate>Sat, 30 Sep 2023 23:00:00 GMT</pubDate>
</item>
<item>
  <title>Merge Ground and Satellite Observations with RFMerge</title>
  <dc:creator>Melanie BACOU</dc:creator>
  <link>https://mbacou.com/posts/2021-01-16-rfmerge/</link>
  <description><![CDATA[ 





<hr>
<p>While estimating winter season frost risk for almond orchards over Central California, project partners reported significant discrepancies between modeled-based temperature estimates provided by ERA5-LAND reanalysis dataset and ground observations. These biases impact the calculation of daily <strong>Frost-Degree-Day</strong> index (FDD) used to price insurance coverage.</p>
<p>Here we want to recalibrate <a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-land">ERA5-LAND</a> hourly temperatures to <a href="https://cimis.water.ca.gov/">CIMIS</a> ground network observations in order to address ERA5-LAND model biases reported over Central California. The procedure involves the following steps:</p>
<ul>
<li>Build CIMIS time-series across OLAM portfolio extent<br>
</li>
<li>Build DEM covariate (using ERA5-LAND extent and spatial resolution)</li>
<li>Use RFMerge procedure<sup>1</sup> to produce calibrated hourly raster stacks over the past 10 years (we limit this calibration from Jan-01 to Apr-30 every year)</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;See Baez-Villanueva, O. M., Zambrano-Bigiarini, M., Diego, J., Osorio, G.-, &amp; Mcnamara, I. (2020). <em>Tutorial for merging satellite-based precipitation datasets with ground observations using RFmerge</em>.</p></div></div><p>This work was initially performed for <strong>WorldCover PBC</strong> and <strong>OLAM US</strong> in early 2021, and redacted here to omit confidential details.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lattice)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(raster)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(scales)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.table)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(zoo)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(cimir)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(sf)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(RFmerge)</span>
<span id="cb1-10"></span>
<span id="cb1-11">pal <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mblabs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>pal</span>
<span id="cb1-12">mblabs<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_labs_on</span>()</span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_data/2020-burn_olam_usa_06.RData"</span>))</span>
<span id="cb1-15"></span>
<span id="cb1-16">my.settings <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb1-17">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">superpose.polygon=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alpha</span>(pal, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"transparent"</span>),</span>
<span id="cb1-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.background=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"light"</span>])</span>
<span id="cb1-19">)</span></code></pre></div>
</div>
<section id="covariate-layers" class="level1">
<h1>Covariate Layers</h1>
<p>Define zone of interest and load covariate layers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clear workspace, keep portfolio details</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./tmp/2020-burn_olam_usa_04.RData"</span>))</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setdiff</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span>(), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dir"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pts.dt"</span>)))</span>
<span id="cb2-4"></span>
<span id="cb2-5">pts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SpatialPointsDataFrame</span>(pts.dt[, .(X,Y)], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(pts.dt), </span>
<span id="cb2-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">proj4string=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:4326"</span>))</span>
<span id="cb2-7"></span>
<span id="cb2-8">usa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getData</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GADM"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">country=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"USA"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">level=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb2-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Limit ZOI to OLAM counties</span></span>
<span id="cb2-10">usa <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> usa[usa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>NAME_2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> pts.dt[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(adm2_nm)],]</span>
<span id="cb2-11">zoi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extent</span>(usa)</span>
<span id="cb2-12">zoi</span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># class      : Extent </span></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># xmin       : -121.4844 </span></span>
<span id="cb2-15"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># xmax       : -117.6166 </span></span>
<span id="cb2-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ymin       : 34.7902 </span></span>
<span id="cb2-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ymax       : 38.07786 </span></span>
<span id="cb2-18"></span>
<span id="cb2-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Catalog hourly ERA5 tmean</span></span>
<span id="cb2-20">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list.files</span>(</span>
<span id="cb2-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"../maps/ERA5LAND/2m_temperature/hourly/usa.ca"</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">".nc"</span>, </span>
<span id="cb2-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">recursive=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">full.names=</span>T)</span>
<span id="cb2-23"></span>
<span id="cb2-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verify data archive</span></span>
<span id="cb2-25">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(f, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nlayers</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brick</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quick=</span>T)))</span>
<span id="cb2-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(n)</span>
<span id="cb2-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [1] 23 24  1 22</span></span>
<span id="cb2-28">bad <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> f[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(n[n<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span>])]</span>
<span id="cb2-29">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(f[bad], <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nlayers</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brick</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quick=</span>T)))</span>
<span id="cb2-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.table</span>(</span>
<span id="cb2-31">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fname =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">basename</span>(f[bad]),</span>
<span id="cb2-32">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nlayers =</span> n)</span>
<span id="cb2-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#                  fname nlayers</span></span>
<span id="cb2-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1: daily_1981-01-01.nc      23</span></span>
<span id="cb2-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2: daily_2020-08-01.nc       1</span></span>
<span id="cb2-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3: daily_2020-10-01.nc      22</span></span>
<span id="cb2-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4: daily_2020-10-02.nc      22</span></span>
<span id="cb2-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5: daily_2020-10-03.nc      22</span></span>
<span id="cb2-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 6: daily_2020-10-15.nc      22</span></span>
<span id="cb2-40"></span>
<span id="cb2-41">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(f[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>], <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) {</span>
<span id="cb2-42">  s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brick</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quick=</span>T)</span>
<span id="cb2-43">  s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setMinMax</span>(s)</span>
<span id="cb2-44">  s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">minValue</span>(s) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">maxValue</span>(s)</span>
<span id="cb2-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(s)</span>
<span id="cb2-46">})</span>
<span id="cb2-47">bad <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> N[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(N, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">!=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">integer</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))]</span></code></pre></div>
</div>
<p>We note that <strong>6 days</strong> on records do not include 24 hourly series.</p>
<p>Next we obtain long-term weather station records from CIMIS API.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set_key</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"27ab5faa-abbb-475e-8af1-f380862bca61"</span>)</span>
<span id="cb3-2">item <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"hly-air-tmp"</span></span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep all CIMIS stations inside ZOI</span></span>
<span id="cb3-5">obs.gis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cimis_station</span>()</span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setDT</span>(obs.gis)</span>
<span id="cb3-7">obs.gis[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, .(ConnectDate, DisconnectDate, HmsLatitude, HmsLongitude)]</span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#    ConnectDate DisconnectDate           HmsLatitude              HmsLongitude</span></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1:    6/7/1982      9/25/1988 36º48'52N / 36.814444 -119º43'54W / -119.731670</span></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2:    6/7/1982      9/25/1988 36º48'52N / 36.814444 -119º43'54W / -119.731670</span></span>
<span id="cb3-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3:    6/7/1982      9/25/1988 36º48'52N / 36.814444 -119º43'54W / -119.731670</span></span>
<span id="cb3-12"></span>
<span id="cb3-13">obs.gis[, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>(</span>
<span id="cb3-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># HMS Lat/Lon to degree</span></span>
<span id="cb3-15">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tstrsplit</span>(HmsLongitude, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" / "</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fixed=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">keep=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>L)),</span>
<span id="cb3-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unlist</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tstrsplit</span>(HmsLatitude, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" / "</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fixed=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">keep=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>L))</span>
<span id="cb3-17">)][, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>(</span>
<span id="cb3-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(X),</span>
<span id="cb3-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(Y)</span>
<span id="cb3-20">)][, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>(</span>
<span id="cb3-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cast dates</span></span>
<span id="cb3-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_start =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(ConnectDate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%m/%d/%Y"</span>),</span>
<span id="cb3-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_end =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(DisconnectDate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%m/%d/%Y"</span>)</span>
<span id="cb3-24">)]</span>
<span id="cb3-25"></span>
<span id="cb3-26">obs.gis[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, .(HmsLongitude, HmsLatitude, X, Y, date_start, date_end)]</span>
<span id="cb3-27">obs.gis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> obs.gis[, .(StationNbr, Name, X, Y, date_start, date_end, IsActive)]</span>
<span id="cb3-28"></span>
<span id="cb3-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># There are duplicated stations (?)</span></span>
<span id="cb3-30">obs.gis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(obs.gis, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"StationNbr"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"date_start"</span>))</span>
<span id="cb3-31"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">anyDuplicated</span>(obs.gis, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"StationNbr"</span>)</span>
<span id="cb3-32"></span>
<span id="cb3-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Date ranges that are available</span></span>
<span id="cb3-34">obs.gis[, .(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(date_start), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(date_end))]</span>
<span id="cb3-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#            V1         V2</span></span>
<span id="cb3-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1: 1982-05-30 1985-07-23</span></span>
<span id="cb3-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2: 2020-10-28 2050-12-31</span></span>
<span id="cb3-38"></span>
<span id="cb3-39">obs.gis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SpatialPointsDataFrame</span>(obs.gis[, .(X, Y)], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(obs.gis),</span>
<span id="cb3-40">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">proj4string=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:4326"</span>))</span>
<span id="cb3-41">obs.gis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crop</span>(obs.gis, zoi)</span>
<span id="cb3-42"></span>
<span id="cb3-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot maps</span></span>
<span id="cb3-44"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crop</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">raster</span>(r, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layer=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), zoi), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">basename</span>(f[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]))</span>
<span id="cb3-45"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span>)</span>
<span id="cb3-46"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(obs.gis, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"green"</span>)][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>(obs.gis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IsActive<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span>)], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>)</span>
<span id="cb3-47"></span>
<span id="cb3-48">obs.lst <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> obs.gis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>data[, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"StationNbr"</span>]</span>
<span id="cb3-49"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(obs.lst)</span>
<span id="cb3-50"></span>
<span id="cb3-51">obs.gis <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setDT</span>(obs.gis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">@</span>data)</span>
<span id="cb3-52"></span>
<span id="cb3-53"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># API request limit at 1,750 records, so let's batch it</span></span>
<span id="cb3-54">drange <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-30"</span>)</span>
<span id="cb3-55">obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(obs.lst, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) {</span>
<span id="cb3-56">  date_start <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> obs.gis[StationNbr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>x, date_start]</span>
<span id="cb3-57">  date_end <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> obs.gis[StationNbr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>x, date_end]</span>
<span id="cb3-58">  date_start <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(drange[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), date_start)</span>
<span id="cb3-59">  date_end <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmin</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(drange[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]), date_end)</span>
<span id="cb3-60">  res <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(date_end <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> date_start) {</span>
<span id="cb3-61">    s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq.Date</span>(date_start, date_end, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"10 days"</span>)</span>
<span id="cb3-62">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(s, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(y) {</span>
<span id="cb3-63">      t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">try</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cimis_data</span>(</span>
<span id="cb3-64">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">targets=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.integer</span>(x), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">items=</span>item, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">measure.unit=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"M"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">start.date=</span>y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">end.date=</span>y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10-1</span>))</span>
<span id="cb3-65">      t <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(t)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"try-error"</span>) <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setDT</span>(t)</span>
<span id="cb3-66">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(t)</span>
<span id="cb3-67">    })</span>
<span id="cb3-68">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb3-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(res)</span>
<span id="cb3-70">})</span>
<span id="cb3-71"></span>
<span id="cb3-72">obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(obs, rbindlist)</span>
<span id="cb3-73"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(obs) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> obs.lst</span>
<span id="cb3-74">obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbindlist</span>(obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">idcol=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"StationNbr"</span>)</span>
<span id="cb3-75"></span>
<span id="cb3-76"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean up resulting dataset</span></span>
<span id="cb3-77">obs[, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>(</span>
<span id="cb3-78">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Name =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb3-79">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb3-80">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Owner =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb3-81">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Standard =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb3-82">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ZipCodes =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb3-83">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Item =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb3-84">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Qc =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb3-85">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Unit =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb3-86">)]</span>
<span id="cb3-87"></span>
<span id="cb3-88"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verify</span></span>
<span id="cb3-89">obs[StationNbr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> Station, .N]</span>
<span id="cb3-90">obs[, .N, by<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>Scope]</span>
<span id="cb3-91">obs[, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>(</span>
<span id="cb3-92">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Station =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,</span>
<span id="cb3-93">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Scope =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span></span>
<span id="cb3-94">)]</span>
<span id="cb3-95"></span>
<span id="cb3-96"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Tally ground observations</span></span>
<span id="cb3-97">obs[, .(.N, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(Date), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(Date)), keyby<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(StationNbr)]</span>
<span id="cb3-98"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># =&gt; "232" station missing records 2160/2880</span></span>
<span id="cb3-99">obs[, .(.N, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Value)), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(Date), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(Date)), keyby<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(StationNbr)]</span>
<span id="cb3-100"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">24</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(drange[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(drange[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-101"></span>
<span id="cb3-102"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep stations nearest to OLAM3 site portfolio</span></span>
<span id="cb3-103">ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">168</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">206</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">145</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">188</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">148</span>)</span>
<span id="cb3-104"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fwrite</span>(obs[StationNbr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(ids)], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./out/CIMIA_OLAM3_2017.csv"</span>))</span></code></pre></div>
</div>
<p>Prepare DEM over ERA5 extent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prepare DEM at ERA5 extent and resolution</span></span>
<span id="cb4-2">dem1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getData</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SRTM"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lon=</span>zoi[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lat=</span>zoi[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb4-3">dem2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getData</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SRTM"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lon=</span>zoi[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lat=</span>zoi[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>])</span>
<span id="cb4-4">dem3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getData</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SRTM"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lon=</span>zoi[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lat=</span>zoi[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>])</span>
<span id="cb4-5">dem4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">getData</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SRTM"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lon=</span>zoi[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lat=</span>zoi[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])</span>
<span id="cb4-6">dem <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">merge</span>(dem1, dem2, dem3, dem4, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ext=</span>zoi)</span></code></pre></div>
</div>
<p>Convert station time-series to <code>zoo</code> wide arrays.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prep station time-series, require ZOO wide format</span></span>
<span id="cb5-2">obs[, Time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(Date), Hour)</span>
<span id="cb5-3">][, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">IDateTime</span>(</span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.POSIXlt</span>(Time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%Y-%m-%d %H%M"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tz=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"America/Los_Angeles"</span>))]</span>
<span id="cb5-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">View</span>(obs[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>, .N)])</span>
<span id="cb5-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2017-01-01 2300 =&gt; 2017-01-01 23:00</span></span>
<span id="cb5-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2017-01-01 2400 =&gt; 2017-01-02 00:00</span></span>
<span id="cb5-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># =&gt; OK</span></span>
<span id="cb5-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setorder</span>(obs, StationNbr, Date, Time)</span>
<span id="cb5-10">obs.ts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dcast</span>(obs, Date<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>Time<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>StationNbr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value.var=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span>)</span>
<span id="cb5-11">obs.ts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">zoo</span>(</span>
<span id="cb5-12">  obs.ts[, .SD, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.SDcols=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)], </span>
<span id="cb5-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order.by=</span>obs.ts[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.POSIXlt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(Date, Time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tz=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"America/Los_Angeles"</span>))]</span>
<span id="cb5-14">)</span></code></pre></div>
</div>
</section>
<section id="recalibrate-hourly-temperature-estimates-using-randon-forest" class="level1">
<h1>Recalibrate Hourly Temperature Estimates using Randon Forest</h1>
<p>Implement Random Forest merge algorithm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Cut the series at Jan-Apr 2017 (time constraint)</span></span>
<span id="cb6-2">drange <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-01-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-04-30"</span>)</span>
<span id="cb6-3">x1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(f <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%like%</span> drange[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])</span>
<span id="cb6-4">x2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">which</span>(f <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%like%</span> drange[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])</span>
<span id="cb6-5">f <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> f[x1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>x2]</span>
<span id="cb6-6">f[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb6-7"></span>
<span id="cb6-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Limit ERA5 covariate</span></span>
<span id="cb6-9">era <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brick</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.list</span>(f))</span>
<span id="cb6-10">era <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crop</span>(era, zoi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">filename=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./out/ERA5_2m_temperature_2017.grd"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">overwrite=</span>T)</span>
<span id="cb6-11">era <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brick</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./out/ERA5_2m_temperature_2017.grd"</span>))</span>
<span id="cb6-12"></span>
<span id="cb6-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Align DEM to ERA5</span></span>
<span id="cb6-14">dem <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">resample</span>(dem, era[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">filename=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./out/SRTM_ERA5.grd"</span>))</span>
<span id="cb6-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">res</span>(dem), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">res</span>(era))</span>
<span id="cb6-16"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extent</span>(dem), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extent</span>(era))</span>
<span id="cb6-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nlayers</span>(era), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(obs.ts))</span>
<span id="cb6-18"></span>
<span id="cb6-19"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ZOI requires `sf`</span></span>
<span id="cb6-20">stations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sf<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sf</span>(obs.gis, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">coords=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4326</span>)</span>
<span id="cb6-21">zoi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_as_sfc</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_bbox</span>(usa))</span>
<span id="cb6-22">zoi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_sf</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ID=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geom=</span>zoi)</span>
<span id="cb6-23"></span>
<span id="cb6-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verify CRS</span></span>
<span id="cb6-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_crs</span>(zoi), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_crs</span>(era))</span>
<span id="cb6-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">identical</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_crs</span>(r), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_crs</span>(era))</span>
<span id="cb6-27"></span>
<span id="cb6-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reproject all to NAD_1983_California_Teale_Albers</span></span>
<span id="cb6-29">NAD83 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:3310"</span>)</span>
<span id="cb6-30">era <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">projectRaster</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span>era, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs=</span>NAD83)</span>
<span id="cb6-31">dem <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">projectRaster</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">from=</span>dem, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs=</span>NAD83)</span>
<span id="cb6-32">stations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(stations, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3310</span>)</span>
<span id="cb6-33">pts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spTransform</span>(pts, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:3310"</span>))</span>
<span id="cb6-34">zoi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_transform</span>(zoi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">crs=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3310</span>)</span>
<span id="cb6-35">obs.gis[, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>(</span>
<span id="cb6-36">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lon =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_coordinates</span>(stations)[, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X"</span>],</span>
<span id="cb6-37">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lat =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">st_coordinates</span>(stations)[, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Y"</span>]</span>
<span id="cb6-38">)]</span>
<span id="cb6-39"></span>
<span id="cb6-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Covariates</span></span>
<span id="cb6-41">covariates <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">era=</span>era, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dem=</span>dem)</span>
<span id="cb6-42">obs.meta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> obs.gis[StationNbr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(obs.ts), .(StationNbr, Lon, Lat)]</span>
<span id="cb6-43"></span>
<span id="cb6-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># RFmerge</span></span>
<span id="cb6-45"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dir.create</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./out/2017_RFmerge_proj"</span>))</span>
<span id="cb6-46">mc.cores <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> parallel<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">detectCores</span>()<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb6-47"></span>
<span id="cb6-48">rfmep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">RFmerge</span>(</span>
<span id="cb6-49">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> obs.ts, </span>
<span id="cb6-50">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metadata =</span> obs.meta, </span>
<span id="cb6-51">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cov =</span> covariates, </span>
<span id="cb6-52">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"StationNbr"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lat=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lat"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lon=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lon"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ED=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb6-53">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mask=</span>zoi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">training=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.9</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">write2disk=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drty.out=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./out/2017_RFmerge_proj"</span>),</span>
<span id="cb6-54">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">parallel=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parallel"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par.nnodes=</span>mc.cores)</span>
<span id="cb6-55"></span>
<span id="cb6-56"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(rfmep)[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nlayers</span>(rfmep))]</span>
<span id="cb6-57"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># [1] "X2017.01.01.01.00.00" "X2017.01.01.02.00.00" "X2017.05.01.00.00.00"</span></span>
<span id="cb6-58"></span>
<span id="cb6-59"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crs</span>(rfmep)</span></code></pre></div>
</div>
<p>Extract recalibrated time-series across almond production sites.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract recalibrated time-series across production sites</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">removeTmpFiles</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">h=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb7-3">dt.imp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extract</span>(rfmep, pts)</span>
<span id="cb7-4">dt.imp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.table</span>(dt.imp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">keep.rownames=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb7-5">dt.imp[, loc_id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> pts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>loc_id]</span>
<span id="cb7-6">dt.imp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">melt</span>(dt.imp, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id.vars=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loc_id"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable.name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value.name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable.factor=</span>F)</span>
<span id="cb7-7">dt.imp[, time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.POSIXct</span>(time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X%Y.%m.%d.%H.%M.%OS"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tz=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"America/Los_Angeles"</span>)]</span>
<span id="cb7-8"></span>
<span id="cb7-9">dt.imp[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(time)]</span>
<span id="cb7-10">dt.imp[, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>(</span>
<span id="cb7-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to IDate</span></span>
<span id="cb7-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.IDate</span>(time),</span>
<span id="cb7-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.ITime</span>(time)</span>
<span id="cb7-14">)]</span>
<span id="cb7-15"></span>
<span id="cb7-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Re-extract ERA5-LAND over period to double-check</span></span>
<span id="cb7-17">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brick</span>(f[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quick=</span>T)</span>
<span id="cb7-18">pts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spTransform</span>(pts, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crs</span>(r))</span>
<span id="cb7-19">dt.era <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(f, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) {</span>
<span id="cb7-20">  r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">brick</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">quick=</span>T)</span>
<span id="cb7-21">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extract</span>(r, pts)</span>
<span id="cb7-22">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.data.table</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">keep.rownames=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb7-23">  y[, loc_id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> pts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>loc_id]</span>
<span id="cb7-24">  y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">melt</span>(y, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id.vars=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loc_id"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable.name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value.name=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">variable.factor=</span>F)</span>
<span id="cb7-25">  y[, time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.POSIXct</span>(time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"X%Y.%m.%d.%H.%M.%OS"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tz=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"UTC"</span>)]</span>
<span id="cb7-26">})</span>
<span id="cb7-27">dt.era <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbindlist</span>(dt.era)</span>
<span id="cb7-28">dt.era[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(time)]</span>
<span id="cb7-29">dt.era[, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>(</span>
<span id="cb7-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to IDate</span></span>
<span id="cb7-31">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.IDate</span>(time),</span>
<span id="cb7-32">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.ITime</span>(time)</span>
<span id="cb7-33">)]</span>
<span id="cb7-34"></span>
<span id="cb7-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Impute ERA5 hourly time-series with output of RFmerge</span></span>
<span id="cb7-36">dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">readRDS</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./tmp/2020-tmean-hourly_olam_ca_almd.rds"</span>))</span>
<span id="cb7-37">dt.imp[dt, on<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(loc_id, date, time), era <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> i.value</span>
<span id="cb7-38">][dt.era, on<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(loc_id, date, time), era_valid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> i.value]</span>
<span id="cb7-39"></span>
<span id="cb7-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save</span></span>
<span id="cb7-41">dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dt[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>dt.imp, on<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(loc_id, date, time)]</span>
<span id="cb7-42">dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(dt, dt.imp[, .SD, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.SDcols=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(dt)])</span>
<span id="cb7-43"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setorder</span>(dt, loc_id, date, time)</span>
<span id="cb7-44"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">saveRDS</span>(dt, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./tmp/2020-tmean-hourly_olam_ca_almd_imputed.rds"</span>))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(x, i, j, t, tmp, dem1, dem2, dem3, dem4, n, x1, x2, dt, dtc)</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">save.image</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./tmp/2020-burn_olam_usa_06.RData"</span>))</span></code></pre></div>
</div>
</section>
<section id="explore-results" class="level1 page-columns page-full">
<h1>Explore Results</h1>
<p>Validate ZOI, DEM, and ERA5 covariates.</p>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Plot with package `terra` (instead of deprecated `raster`)</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(terra)</span>
<span id="cb9-3">era <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rast</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./_out/ERA5_2m_temperature_2017.grd"</span>))</span>
<span id="cb9-4"></span>
<span id="cb9-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Align projections</span></span>
<span id="cb9-6">pts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vect</span>(pts)</span>
<span id="cb9-7">stations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vect</span>(stations)</span>
<span id="cb9-8">zoi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vect</span>(zoi)</span>
<span id="cb9-9"></span>
<span id="cb9-10">pts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">project</span>(pts, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"epsg:4326"</span>)</span>
<span id="cb9-11">stations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">project</span>(stations, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"epsg:4326"</span>)</span>
<span id="cb9-12">zoi <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">project</span>(zoi, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"epsg:4326"</span>)</span>
<span id="cb9-13">era <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">project</span>(era[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"epsg:4326"</span>)</span>
<span id="cb9-14">dem <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">project</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rast</span>(dem), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"epsg:4326"</span>)</span>
<span id="cb9-15">rfmep <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">project</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rast</span>(rfmep[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"epsg:4326"</span>)</span>
<span id="cb9-16"></span>
<span id="cb9-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Validate ERA5 and DEM covariates</span></span>
<span id="cb9-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(era, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ext=</span>zoi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(era), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">terrain.colors</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb9-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5-LAND Temperature (°C) on 2017-01-01 01:00"</span>)</span>
<span id="cb9-20"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid</span>()</span>
<span id="cb9-21"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(stations, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>]])</span>
<span id="cb9-22"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>])</span>
<span id="cb9-23"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pts[pts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>loc_id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">82</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">83</span>), ], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>)</span>
<span id="cb9-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb9-25">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CIMIS WS"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OLAM site"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Portfolio site"</span>),</span>
<span id="cb9-26">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>))</span>
<span id="cb9-27"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(dem, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ext=</span>zoi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(dem), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">terrain.colors</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>),</span>
<span id="cb9-28">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SRTM 90m (meter)"</span>)</span>
<span id="cb9-29"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid</span>()</span>
<span id="cb9-30"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>])</span>
<span id="cb9-31"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(stations, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>)][<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>(obs.gis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>IsActive<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span>)], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>)</span>
<span id="cb9-32"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb9-33">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Active station"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Stale station"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Production site"</span>),</span>
<span id="cb9-34">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>)], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>))</span></code></pre></div>
<div class="cell column-screen quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>CIMIS station observations between Jan-Apr 2017.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">obs[, .(</span>
<span id="cb10-2">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Obs.</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">comma</span>(.N), </span>
<span id="cb10-3">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NA</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">percent</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Value))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>.N), </span>
<span id="cb10-4">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Min.</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(Value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T), </span>
<span id="cb10-5">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Max.</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(Value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T),</span>
<span id="cb10-6">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Date Range</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">range</span>(Date, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" - "</span>)</span>
<span id="cb10-7">), keyby<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(StationNbr)] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-8">  rmarkdown<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paged_table</span>()</span></code></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
<script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["StationNbr"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Obs."],"name":[2],"type":["chr"],"align":["left"]},{"label":["NA"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Min."],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Max."],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Date Range"],"name":[6],"type":["chr"],"align":["left"]}],"data":[{"1":"105","2":"2,880","3":"0%","4":"-1.6","5":"30.9","6":"2017-01-01 - 2017-05-01"},{"1":"113","2":"2,880","3":"0%","4":"-0.9","5":"31.1","6":"2017-01-01 - 2017-05-01"},{"1":"114","2":"2,880","3":"0%","4":"0.3","5":"29.6","6":"2017-01-01 - 2017-05-01"},{"1":"124","2":"2,880","3":"0%","4":"-2.2","5":"28.3","6":"2017-01-01 - 2017-05-01"},{"1":"125","2":"2,880","3":"0%","4":"-0.7","5":"30.7","6":"2017-01-01 - 2017-05-01"},{"1":"126","2":"2,880","3":"5%","4":"-2.1","5":"29.3","6":"2017-01-01 - 2017-05-01"},{"1":"142","2":"2,880","3":"0%","4":"-1.4","5":"34.9","6":"2017-01-01 - 2017-05-01"},{"1":"143","2":"2,880","3":"0%","4":"-2.1","5":"29.3","6":"2017-01-01 - 2017-05-01"},{"1":"146","2":"2,880","3":"0%","4":"-1.0","5":"31.2","6":"2017-01-01 - 2017-05-01"},{"1":"148","2":"2,880","3":"0%","4":"-4.0","5":"28.4","6":"2017-01-01 - 2017-05-01"},{"1":"15","2":"2,880","3":"1%","4":"-0.9","5":"30.2","6":"2017-01-01 - 2017-05-01"},{"1":"160","2":"2,880","3":"38%","4":"0.4","5":"29.5","6":"2017-01-01 - 2017-05-01"},{"1":"161","2":"2,880","3":"0%","4":"0.0","5":"29.3","6":"2017-01-01 - 2017-05-01"},{"1":"163","2":"2,880","3":"7%","4":"-3.9","5":"28.2","6":"2017-01-01 - 2017-05-01"},{"1":"165","2":"2,880","3":"7%","4":"-5.1","5":"30.8","6":"2017-01-01 - 2017-05-01"},{"1":"167","2":"2,880","3":"0%","4":"-1.0","5":"29.3","6":"2017-01-01 - 2017-05-01"},{"1":"169","2":"2,880","3":"9%","4":"-4.5","5":"29.4","6":"2017-01-01 - 2017-05-01"},{"1":"182","2":"2,880","3":"0%","4":"-0.9","5":"29.4","6":"2017-01-01 - 2017-05-01"},{"1":"183","2":"2,880","3":"0%","4":"-12.8","5":"28.0","6":"2017-01-01 - 2017-05-01"},{"1":"188","2":"2,880","3":"0%","4":"-3.9","5":"28.9","6":"2017-01-01 - 2017-05-01"},{"1":"189","2":"2,880","3":"0%","4":"-6.1","5":"30.0","6":"2017-01-01 - 2017-05-01"},{"1":"190","2":"2,880","3":"0%","4":"-1.8","5":"32.0","6":"2017-01-01 - 2017-05-01"},{"1":"194","2":"2,880","3":"22%","4":"-0.5","5":"28.1","6":"2017-01-01 - 2017-05-01"},{"1":"2","2":"2,880","3":"4%","4":"-1.5","5":"29.8","6":"2017-01-01 - 2017-05-01"},{"1":"202","2":"2,880","3":"16%","4":"0.8","5":"28.9","6":"2017-01-01 - 2017-05-01"},{"1":"203","2":"2,880","3":"2%","4":"-13.0","5":"30.6","6":"2017-01-01 - 2017-05-01"},{"1":"205","2":"2,880","3":"0%","4":"-0.4","5":"29.4","6":"2017-01-01 - 2017-05-01"},{"1":"206","2":"2,880","3":"0%","4":"-1.8","5":"28.5","6":"2017-01-01 - 2017-05-01"},{"1":"21","2":"2,880","3":"55%","4":"0.3","5":"29.8","6":"2017-01-01 - 2017-05-01"},{"1":"232","2":"2,160","3":"0%","4":"0.5","5":"28.3","6":"2017-01-31 - 2017-05-01"},{"1":"248","2":"2,880","3":"12%","4":"0.0","5":"28.6","6":"2017-01-01 - 2017-05-01"},{"1":"249","2":"2,880","3":"0%","4":"-0.2","5":"29.1","6":"2017-01-01 - 2017-05-01"},{"1":"252","2":"2,880","3":"0%","4":"0.5","5":"29.8","6":"2017-01-01 - 2017-05-01"},{"1":"35","2":"2,880","3":"0%","4":"-10.6","5":"27.4","6":"2017-01-01 - 2017-05-01"},{"1":"39","2":"2,880","3":"0%","4":"-0.7","5":"29.8","6":"2017-01-01 - 2017-05-01"},{"1":"5","2":"2,880","3":"4%","4":"-0.5","5":"29.9","6":"2017-01-01 - 2017-05-01"},{"1":"52","2":"2,880","3":"0%","4":"2.8","5":"30.2","6":"2017-01-01 - 2017-05-01"},{"1":"54","2":"2,880","3":"2%","4":"-11.8","5":"29.7","6":"2017-01-01 - 2017-05-01"},{"1":"56","2":"2,880","3":"0%","4":"-1.5","5":"28.4","6":"2017-01-01 - 2017-05-01"},{"1":"7","2":"2,880","3":"0%","4":"-1.1","5":"29.4","6":"2017-01-01 - 2017-05-01"},{"1":"70","2":"2,880","3":"0%","4":"-1.5","5":"28.1","6":"2017-01-01 - 2017-05-01"},{"1":"71","2":"2,880","3":"0%","4":"-1.2","5":"27.5","6":"2017-01-01 - 2017-05-01"},{"1":"80","2":"2,880","3":"0%","4":"-1.5","5":"29.2","6":"2017-01-01 - 2017-05-01"},{"1":"86","2":"2,880","3":"0%","4":"-1.1","5":"30.6","6":"2017-01-01 - 2017-05-01"},{"1":"88","2":"2,880","3":"0%","4":"-2.9","5":"28.1","6":"2017-01-01 - 2017-05-01"},{"1":"92","2":"2,880","3":"0%","4":"-3.5","5":"28.1","6":"2017-01-01 - 2017-05-01"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>CIMIS Station Observations, Jan-Apr 2017</p>
</div>
</div>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(obs.ts[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alpha</span>(pal[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>),</span>
<span id="cb11-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sub=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Station"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(obs.ts)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CIMIS Hourly Temp. °C"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid</span>()</span>
<span id="cb11-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(obs.ts[,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alpha</span>(pal[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>),</span>
<span id="cb11-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sub=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Station"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(obs.ts)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CIMIS Hourly Temp. °C"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb11-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid</span>()</span></code></pre></div>
<div class="cell column-screen quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">histogram</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>StationNbr, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>obs, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>,</span>
<span id="cb12-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alpha</span>(pal[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"light"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">layout=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>),</span>
<span id="cb12-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">par.settings=</span>my.settings,</span>
<span id="cb12-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Jan-Apr 2017 - CIMIS Hourly Temp. °C across meteo stations"</span>)</span></code></pre></div>
<div class="cell column-screen quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-4-4.png" class="img-fluid"></p>
</div>
</div>
</div>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(rfmep, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ext=</span>zoi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(rfmep)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], </span>
<span id="cb13-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">terrain.colors</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,</span>
<span id="cb13-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"RF-MEP Temperatures °C"</span>)</span>
<span id="cb13-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid</span>()</span>
<span id="cb13-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span>
<span id="cb13-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(stations[stations<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>StationNbr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(obs.ts),], </span>
<span id="cb13-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span>
<span id="cb13-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb13-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Active station"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Production site"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>))</span>
<span id="cb13-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(era, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ext=</span>zoi, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(era)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], </span>
<span id="cb13-11">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">terrain.colors</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">11</span>,</span>
<span id="cb13-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5-LAND Temperatures °C"</span>)</span>
<span id="cb13-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid</span>()</span>
<span id="cb13-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span>
<span id="cb13-15"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(stations[stations<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>StationNbr <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(obs.ts),], </span>
<span id="cb13-16">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span>
<span id="cb13-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bty=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n"</span>,</span>
<span id="cb13-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Active station"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Production site"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>))</span></code></pre></div>
<div class="cell column-screen quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>Hourly time-series from nearest CIMIS ground stations compared to hourly time-series at production sites from ERA5-LAND.</p>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wireframe</span>(Value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(Date)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>Time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>obs, </span>
<span id="cb14-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hour"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sub=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nearest CIMIS Stations - Hourly Temp. °C"</span>,</span>
<span id="cb14-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.regions=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">terrain.colors</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drape=</span>T,</span>
<span id="cb14-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">at=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.breaks</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">35</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb14-5">)</span>
<span id="cb14-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wireframe</span>(era<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(date)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dt.imp, </span>
<span id="cb14-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hour"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"°C"</span>,  </span>
<span id="cb14-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sub=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Production Sites - Hourly Temp. °C (ERA5-LAND)"</span>,</span>
<span id="cb14-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.regions=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">terrain.colors</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drape=</span>T,</span>
<span id="cb14-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">at=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.breaks</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span>), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb14-11">)</span></code></pre></div>
<div class="cell column-screen quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>Mean recalibration effect across production sites (after RFmerge procedure):</p>
<div class="cell preview-image">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wireframe</span>((value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>era)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(date)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data=</span>dt.imp, </span>
<span id="cb15-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Date"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hour"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"°C"</span>,  </span>
<span id="cb15-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sub=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5-LAND Mean Recalibration Effect</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">across Production Sites</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Hourly Temp. °C"</span>,</span>
<span id="cb15-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col.regions=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">terrain.colors</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">drape=</span>T</span>
<span id="cb15-5">)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://mbacou.com/posts/2021-01-16-rfmerge/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>FDD index across sites between Feb-01 and Mar-31, 2017 (before and after ground calibration):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">dt.imp[date <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%between%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-02-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2017-03-31"</span>), .(</span>
<span id="cb16-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">era =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(era, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T),</span>
<span id="cb16-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">era_valid =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(era_valid, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T),</span>
<span id="cb16-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb16-5">), by<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(loc_id, date)][, .(</span>
<span id="cb16-6">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FDD (before)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fifelse</span>(era<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(era, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T),</span>
<span id="cb16-7">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FDD (validate)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fifelse</span>(era_valid<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(era_valid, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T),</span>
<span id="cb16-8">  <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">FDD (after)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fifelse</span>(value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>(value, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb16-9">), keyby<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(loc_id)]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb16-10">  rmarkdown<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paged_table</span>()</span></code></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
<script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["loc_id"],"name":[1],"type":["int"],"align":["right"]},{"label":["FDD (before)"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["FDD (validate)"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["FDD (after)"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"0.0000000000","3":"0.0000000000","4":"-2.1666767"},{"1":"2","2":"0.0000000000","3":"0.0000000000","4":"-2.1666767"},{"1":"3","2":"0.0000000000","3":"0.0000000000","4":"-2.1666767"},{"1":"4","2":"0.0000000000","3":"0.0000000000","4":"-2.1666767"},{"1":"5","2":"0.0000000000","3":"0.0000000000","4":"-2.1666767"},{"1":"6","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"7","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"8","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"9","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"10","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"11","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"12","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"13","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"14","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"15","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"16","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"17","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"18","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"19","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"20","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"21","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"22","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"23","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"24","2":"0.0000000000","3":"0.0000000000","4":"-3.4761350"},{"1":"25","2":"0.0000000000","3":"0.0000000000","4":"-0.7498333"},{"1":"26","2":"0.0000000000","3":"0.0000000000","4":"-0.5087167"},{"1":"27","2":"0.0000000000","3":"0.0000000000","4":"-0.5087167"},{"1":"28","2":"0.0000000000","3":"0.0000000000","4":"-0.5087167"},{"1":"29","2":"0.0000000000","3":"0.0000000000","4":"-0.5087167"},{"1":"30","2":"0.0000000000","3":"0.0000000000","4":"-0.3167700"},{"1":"31","2":"0.0000000000","3":"0.0000000000","4":"-0.3167700"},{"1":"32","2":"0.0000000000","3":"0.0000000000","4":"-0.3167700"},{"1":"33","2":"0.0000000000","3":"0.0000000000","4":"-0.3167700"},{"1":"34","2":"0.0000000000","3":"0.0000000000","4":"-0.5087167"},{"1":"35","2":"0.0000000000","3":"0.0000000000","4":"-0.5087167"},{"1":"36","2":"0.0000000000","3":"0.0000000000","4":"-0.3167700"},{"1":"37","2":"0.0000000000","3":"0.0000000000","4":"-0.3167700"},{"1":"38","2":"0.0000000000","3":"0.0000000000","4":"-0.3167700"},{"1":"39","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"40","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"41","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"42","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"43","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"44","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"45","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"46","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"47","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"48","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"49","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"50","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"51","2":"0.0000000000","3":"0.0000000000","4":"-1.0882958"},{"1":"52","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"53","2":"0.0000000000","3":"0.0000000000","4":"-0.6372300"},{"1":"54","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"55","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"56","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"57","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"58","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"59","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"60","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"61","2":"0.0000000000","3":"0.0000000000","4":"-0.6372300"},{"1":"62","2":"0.0000000000","3":"0.0000000000","4":"-0.6372300"},{"1":"63","2":"0.0000000000","3":"0.0000000000","4":"-0.6372300"},{"1":"64","2":"0.0000000000","3":"0.0000000000","4":"-0.6372300"},{"1":"65","2":"0.0000000000","3":"0.0000000000","4":"-0.6372300"},{"1":"66","2":"0.0000000000","3":"0.0000000000","4":"-0.6372300"},{"1":"67","2":"0.0000000000","3":"0.0000000000","4":"-0.6372300"},{"1":"68","2":"0.0000000000","3":"0.0000000000","4":"-0.6372300"},{"1":"69","2":"0.0000000000","3":"0.0000000000","4":"-0.9189067"},{"1":"70","2":"0.0000000000","3":"0.0000000000","4":"-1.0882958"},{"1":"71","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"72","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"73","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"74","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"75","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"76","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"77","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"78","2":"0.0000000000","3":"0.0000000000","4":"-2.9816700"},{"1":"79","2":"0.0000000000","3":"0.0000000000","4":"-2.9816700"},{"1":"80","2":"0.0000000000","3":"0.0000000000","4":"-2.9816700"},{"1":"81","2":"0.0000000000","3":"0.0000000000","4":"-2.9816700"},{"1":"82","2":"-0.0002197266","3":"-0.0002197266","4":"-3.7889842"},{"1":"83","2":"-0.0002197266","3":"-0.0002197266","4":"-3.7889842"},{"1":"84","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"85","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"86","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"87","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"88","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"89","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"90","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"91","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"92","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"93","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"94","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"95","2":"-0.2233642638","3":"-0.2233642638","4":"-3.3181283"},{"1":"96","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"97","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"98","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"99","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"100","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"101","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"102","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"103","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"104","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"105","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"106","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"107","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"108","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"109","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"110","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"111","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"112","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"113","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"114","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"115","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"116","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"117","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"118","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"119","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"120","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"121","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"122","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"123","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"124","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"125","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"126","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"127","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"128","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"129","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"130","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"131","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"132","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"133","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"134","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"135","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"136","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"137","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"138","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"139","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"140","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"141","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"},{"1":"142","2":"0.0000000000","3":"0.0000000000","4":"-0.5150467"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>FDD across sites between Feb-01 and Mar-31, 2017</p>
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bacou2021,
  author = {BACOU, Melanie},
  title = {Merge {Ground} and {Satellite} {Observations} with {RFMerge}},
  date = {2021-01-16},
  url = {https://mbacou.com/posts/2021-01-16-rfmerge},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bacou2021" class="csl-entry quarto-appendix-citeas">
BACOU, Melanie. 2021. <span>“Merge Ground and Satellite Observations
with RFMerge.”</span> January 16, 2021. <a href="https://mbacou.com/posts/2021-01-16-rfmerge">https://mbacou.com/posts/2021-01-16-rfmerge</a>.
</div></div></section></div> ]]></description>
  <category>meteo</category>
  <category>risk modeling</category>
  <guid>https://mbacou.com/posts/2021-01-16-rfmerge/</guid>
  <pubDate>Sat, 16 Jan 2021 00:00:00 GMT</pubDate>
</item>
<item>
  <title>ERA5-LAND Temperature Validation (California)</title>
  <dc:creator>Melanie BACOU</dc:creator>
  <link>https://mbacou.com/posts/2020-12-02-era5-ca/</link>
  <description><![CDATA[ 





<hr>
<p>While estimating winter season frost risk for almond orchards over Central California, project partners reported significant discrepancies between modeled-based temperature estimates provided by <strong>ERA5-LAND Reanalysis</strong> dataset and ground observations from meteo stations. These biases impact the calculation of daily <strong>Frost-Degree-Day</strong> index (FDD) used to price insurance coverage.</p>
<p>In this analysis we look into more details at ERA5-LAND temperature estimate biases against ground observations collected from NOAA GHCN network of meteorological stations. In particular:</p>
<ul>
<li>Can we justify Y2017 correction to ERA5-LAND hourly temperature grids over OLAM portfolio?</li>
<li>Can we perform a portfolio-wide ERA5-LAND temperature validation against NOAA GHCN ground records?</li>
</ul>
<p>This work was initially produced for <strong>WorldCover PBC</strong> and <strong>OLAM US</strong> in early 2021, and redacted here to omit confidential details.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(here)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(mblabs)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(lubridate)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(raster)</span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(scales)</span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(data.table)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(zoo)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(rnoaa)</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_labs_on</span>()</span>
<span id="cb1-12">pal2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">alpha</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unname</span>(pal[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"purple"</span>)]), .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span>
<span id="cb1-13"></span>
<span id="cb1-14"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./_data/2020-burn_olam_usa_07.RData"</span>))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clear workspace, keep only portfolio details</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">load</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./_data/2020-burn_olam_usa_06.RData"</span>))</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">list=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setdiff</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ls</span>(), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dir"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pts.dt"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dt.era"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dt.imp"</span>)))</span>
<span id="cb2-4"></span>
<span id="cb2-5">pts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SpatialPointsDataFrame</span>(pts.dt[, .(X,Y)], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(pts.dt), </span>
<span id="cb2-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">proj4string=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:4326"</span>))</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get GHCN ground obs across ZOI</span></span>
<span id="cb3-2">stations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ghcnd_stations</span>()</span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setDT</span>(stations)</span>
<span id="cb3-4">vars <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PRCP"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TAVG"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TMAX"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TMIN"</span>)</span>
<span id="cb3-5">stations[element <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> vars, .N, by<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>element]</span>
<span id="cb3-6">stations <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stations[state<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"CA"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> element <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> vars]</span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to spatial</span></span>
<span id="cb3-9">stations.sp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">SpatialPointsDataFrame</span>(stations[, .(longitude, latitude)], stations,</span>
<span id="cb3-10">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">proj4string=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:4326"</span>))</span>
<span id="cb3-11"></span>
<span id="cb3-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep only stations within 30 km of any OLAM site</span></span>
<span id="cb3-13">pts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spTransform</span>(pts, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:3310"</span>))</span>
<span id="cb3-14">stations.sp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spTransform</span>(stations.sp, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:3310"</span>))</span>
<span id="cb3-15">dist <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rgeos<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gWithinDistance</span>(stations.sp, pts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">dist=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">30</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">byid=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb3-16">dist <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colSums</span>(dist)</span>
<span id="cb3-17"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(dist) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stations.sp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id</span>
<span id="cb3-18">dist <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dist[dist<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb3-19">ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(dist)</span>
<span id="cb3-20"></span>
<span id="cb3-21">pts <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spTransform</span>(pts, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:4326"</span>))</span>
<span id="cb3-22">stations.sp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">spTransform</span>(stations.sp, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">CRS</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+init=epsg:4326"</span>))</span>
<span id="cb3-23"></span>
<span id="cb3-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">extent</span>(pts), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lty=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>)</span>
<span id="cb3-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(stations.sp[stations.sp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> ids,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span>
<span id="cb3-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span>
<span id="cb3-27"></span>
<span id="cb3-28">ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stations[id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> ids <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> element <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> vars <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> last_year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2009</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(id)]</span>
<span id="cb3-29">stations[id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> ids <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> element <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> vars]</span>
<span id="cb3-30"></span>
<span id="cb3-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get daily station time-series for the 29 selected</span></span>
<span id="cb3-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Request seems to time out when too large so let's batch it</span></span>
<span id="cb3-33">stations.dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(ids, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) </span>
<span id="cb3-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">try</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ghcnd_search</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">var=</span>vars, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_min=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2010-01-01"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">refresh=</span>T)))</span>
<span id="cb3-35">stations.dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stations.dt[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sapply</span>(stations.dt, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">class</span>(x)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"try-error"</span>)]</span>
<span id="cb3-36">stations.dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">do.call</span>(c, stations.dt)</span>
<span id="cb3-37">stations.dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lapply</span>(stations.dt, <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setnames</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>))</span>
<span id="cb3-38">stations.dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbindlist</span>(stations.dt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">idcol=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"var"</span>)</span>
<span id="cb3-39"></span>
<span id="cb3-40">stations.dt[, .N, by<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>var]</span>
<span id="cb3-41"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span>
<span id="cb3-42"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> stations.dt[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(var)]) stations.dt[var<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>i, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span>i)]</span>
<span id="cb3-43"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">par</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mfrow=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb3-44"></span>
<span id="cb3-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert tenths of degrees Celsius to °C</span></span>
<span id="cb3-46">stations.dt[, value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(value)</span>
<span id="cb3-47">][var <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tolower</span>(vars[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>]), value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> value<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>]</span>
<span id="cb3-48"></span>
<span id="cb3-49">ids <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> stations.dt[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(id)]</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract ERA5 at stations coordinates</span></span>
<span id="cb4-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2010-01-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2020-07-31"</span>)</span>
<span id="cb4-3">cat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wc_catalog</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">code=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"era5_temp_h_usa_ca"</span>)</span>
<span id="cb4-4">dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">wc_extract</span>(</span>
<span id="cb4-5">  stations[id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> ids, .N, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by=</span>.(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loc_id=</span>id, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">X=</span>longitude, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Y=</span>latitude)][, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N:=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>], </span>
<span id="cb4-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">catalog=</span>cat)</span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verify sequence</span></span>
<span id="cb4-9">dt[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .N), .(date, time)]</span>
<span id="cb4-10">dt[, .N, by<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date), loc_id)][N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8760</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8784</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5112</span>]</span>
<span id="cb4-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># =&gt; OK</span></span>
<span id="cb4-12"></span>
<span id="cb4-13">dt[,</span>
<span id="cb4-14">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apply timezone</span></span>
<span id="cb4-15">  time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with_tz</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.POSIXct</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(date, time, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sep=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tzone=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"America/Los_Angeles"</span>)</span>
<span id="cb4-16">][, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>(</span>
<span id="cb4-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to IDate</span></span>
<span id="cb4-18">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.IDate</span>(time),</span>
<span id="cb4-19">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.ITime</span>(time)</span>
<span id="cb4-20">)]</span>
<span id="cb4-21"></span>
<span id="cb4-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Verify</span></span>
<span id="cb4-23">dt[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .N), .(date, time)]</span>
<span id="cb4-24">dt[, .N, by<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>loc_id][, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">uniqueN</span>(N)]</span>
<span id="cb4-25">dt[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(value)]</span>
<span id="cb4-26">dt[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(value)]</span>
<span id="cb4-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span id="cb4-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># -6.623  10.852  17.053  17.939  24.544  43.893  </span></span>
<span id="cb4-29"></span>
<span id="cb4-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Daily</span></span>
<span id="cb4-31">dt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dt[, .(</span>
<span id="cb4-32">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Tmean =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T),</span>
<span id="cb4-33">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Tmin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">min</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T),</span>
<span id="cb4-34">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Tmax =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">max</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb4-35">), keyby<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(loc_id, date)]</span>
<span id="cb4-36"></span>
<span id="cb4-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine with GHCN</span></span>
<span id="cb4-38">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dcast</span>(stations.dt, id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span>date<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>var, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value.var=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span>)</span>
<span id="cb4-39">dt[tmp, on<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">loc_id=</span>id, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date=</span>date), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">:=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>(</span>
<span id="cb4-40">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GHCN_Tmean =</span> i.tavg,</span>
<span id="cb4-41">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GHCN_Tmin =</span> i.tmin,</span>
<span id="cb4-42">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GHCN_Tmax =</span> i.tmax</span>
<span id="cb4-43">)]</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rm</span>(x, i, j, t, tmp)</span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">save.image</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"./_data/2020-burn_olam_usa_07.RData"</span>))</span></code></pre></div>
</div>
<section id="results" class="level1 page-columns page-full">
<h1>Results</h1>
<p>10-year comparisons between ERA5-LAND and GHCN station network observations over Feb-March risk period. 11 stations (under 30-km from almond production sites and with daily temperature records after 2010) are selected for this comparison.</p>
<div class="cell preview-image">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(terra)</span>
<span id="cb6-2">r <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rast</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">here</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_data/daily_2020-02-01.nc"</span>))</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(r[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ext=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ext</span>(stations.sp[stations.sp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> ids,]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>),</span>
<span id="cb6-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">terrain.colors</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(r)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>],</span>
<span id="cb6-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Hourly Tmean (°C) - ERA5 2020-02-01 00:00"</span>)</span>
<span id="cb6-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid</span>()</span>
<span id="cb6-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">crop</span>(stations.sp[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span>stations.sp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> ids,], pts), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span>
<span id="cb6-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(stations.sp[stations.sp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> ids,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pts, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span>
<span id="cb6-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(pts[pts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>loc_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>,], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">add=</span>T)</span>
<span id="cb6-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">legend</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bottom"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bg=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"light"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cex=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>,</span>
<span id="cb6-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GHCN station"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GHCN station ≤ 30-km"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OLAM production site"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Main site"</span>),</span>
<span id="cb6-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>)], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pch=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"o"</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>List of GHCN stations retained in the analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">stations[id <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> ids <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> element <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TMIN"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TAVG"</span>), .(</span>
<span id="cb7-2">  first_year, last_year</span>
<span id="cb7-3">), keyby<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(id, name, element)] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 38%">
<col style="width: 11%">
<col style="width: 16%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: left;">name</th>
<th style="text-align: left;">element</th>
<th style="text-align: right;">first_year</th>
<th style="text-align: right;">last_year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">USC00040444</td>
<td style="text-align: left;">BAKERSFIELD 5 NW</td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">USC00045233</td>
<td style="text-align: left;">MADERA</td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1928</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USC00045532</td>
<td style="text-align: left;">MERCED</td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1899</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">USC00048122</td>
<td style="text-align: left;">SHAFTER 6E</td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USC00048752</td>
<td style="text-align: left;">TAFT</td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1994</td>
<td style="text-align: right;">2011</td>
</tr>
<tr class="even">
<td style="text-align: left;">USR0000CCAT</td>
<td style="text-align: left;">CATHEYS VALLEY CALIFORNIA</td>
<td style="text-align: left;">TAVG</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USR0000CCAT</td>
<td style="text-align: left;">CATHEYS VALLEY CALIFORNIA</td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1999</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">USR0000CGSP</td>
<td style="text-align: left;">GREEN SPRING CALIFORNIA</td>
<td style="text-align: left;">TAVG</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USR0000CGSP</td>
<td style="text-align: left;">GREEN SPRING CALIFORNIA</td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1990</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">USW00023155</td>
<td style="text-align: left;">BAKERSFIELD AP</td>
<td style="text-align: left;">TAVG</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USW00023155</td>
<td style="text-align: left;">BAKERSFIELD AP</td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1937</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">USW00023257</td>
<td style="text-align: left;">MERCED MUNI AP</td>
<td style="text-align: left;">TAVG</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2005</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USW00023257</td>
<td style="text-align: left;">MERCED MUNI AP</td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">USW00023258</td>
<td style="text-align: left;">MODESTO CITY CO AP</td>
<td style="text-align: left;">TAVG</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2005</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USW00023258</td>
<td style="text-align: left;">MODESTO CITY CO AP</td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1927</td>
<td style="text-align: right;">2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">USW00093242</td>
<td style="text-align: left;">MADERA MUNI AP</td>
<td style="text-align: left;">TAVG</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2005</td>
</tr>
<tr class="odd">
<td style="text-align: left;">USW00093242</td>
<td style="text-align: left;">MADERA MUNI AP</td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1998</td>
<td style="text-align: right;">2020</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>10-year summary.</p>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> stations.dt[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(var)]) stations.dt[var<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span>i, </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">hist</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">main=</span>i, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span>pal2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">border=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"light"</span>])]</span></code></pre></div>
<div class="cell column-screen quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-3-4.png" class="img-fluid"></p>
</div>
</div>
</div>
</section>
<section id="temperature-minima" class="level1 page-columns page-full">
<h1>Temperature Minima</h1>
<p>2010-2014 and 2015-2020.</p>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">prd <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2020-02-01"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2020-03-31"</span>)</span>
<span id="cb9-2">dt[, sdate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.Date</span>(date)][, year <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date)]</span>
<span id="cb9-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(dt<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>sdate) <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span></span>
<span id="cb9-4"></span>
<span id="cb9-5">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dt[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%between%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(prd), .(</span>
<span id="cb9-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Tmin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T),</span>
<span id="cb9-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">GHCN_Tmin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(GHCN_Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T),</span>
<span id="cb9-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diff_Tmean =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Tmean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> GHCN_Tmean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T),</span>
<span id="cb9-9">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diff_Tmin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Tmin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> GHCN_Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb9-10">), by<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(year, date, sdate)</span>
<span id="cb9-11">][, sign <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="er" style="color: #AD0000;
background-color: null;
font-style: inherit;">=</span> diff_Tmin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]</span>
<span id="cb9-12"></span>
<span id="cb9-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gglabs</span>(tmp[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%between%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>)], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>sdate)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 Tmin"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 Tmin"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>GHCN_Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GHCN Tmin"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>GHCN_Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GHCN Tmin"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_labels=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%b-%d"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2 days"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span>pal2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature Mean of Min (°C) -- ERA5 vs. GHCN (19 WS)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>))</span>
<span id="cb9-24"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gglabs</span>(tmp[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>sdate)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 Tmin"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 Tmin"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>GHCN_Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GHCN Tmin"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb9-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>GHCN_Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GHCN Tmin"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_labels=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%b-%d"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"2 days"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span>pal2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-33">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature Mean of Min (°C) -- ERA5 vs. GHCN (19 WS)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>))</span></code></pre></div>
<div class="cell column-screen quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>2010-2014 and 2015-2020.</p>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gglabs</span>(tmp[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%between%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>)], </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(sdate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>sign)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>sdate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>GHCN_Tmin), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lineend=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"butt"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>GHCN_Tmin)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_labels=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%b-%d"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3 day"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span>pal2, </span>
<span id="cb10-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 ≤ GHCN"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 &gt; GHCN"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature Mean of Min (°C) -- ERA5 vs. GHCN WS"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>))</span>
<span id="cb10-12"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gglabs</span>(tmp[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">year</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2014</span>], </span>
<span id="cb10-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(sdate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>sign)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_segment</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xend=</span>sdate, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yend=</span>GHCN_Tmin), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lineend=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"butt"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>GHCN_Tmin)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_date</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">date_labels=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%b-%d"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"3 day"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span>pal2,</span>
<span id="cb10-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 ≤ GHCN"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 &gt; GHCN"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ncol=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Temperature Mean of Min (°C) -- ERA5 vs. GHCN WS"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb10-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>))</span></code></pre></div>
<div class="cell column-screen quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>Differences between ERA5 Tmin and GHCN Tmin over risk period:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">dt[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(prd), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(Tmin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> GHCN_Tmin)]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
-5.9080 -1.1880  0.2500  0.2953  1.5979  9.7133     206 </code></pre>
</div>
</div>
<p>Differences between ERA5 Tmin and GHCN Tmin over risk period (GHCN below 0°C):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">dt[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(prd) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> GHCN_Tmin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(Tmin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> GHCN_Tmin)]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.364   1.822   2.350   2.058   2.350   2.405 </code></pre>
</div>
</div>
<p>Differences between ERA5 Tmean and GHCN Tmean over risk period:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">dt[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(prd), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(Tmean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> GHCN_Tmean)]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
-4.5485 -1.7915 -1.1321 -0.9827 -0.1575  1.9854     359 </code></pre>
</div>
</div>
<p>Differences between ERA5 Tmax and GHCN Tmax over risk period:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">dt[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(prd), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(Tmax <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> GHCN_Tmax)]</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
-4.6174 -1.4994 -0.6568 -0.6119  0.1649  4.7969     204 </code></pre>
</div>
</div>
<p>Correlation summary on temperature minima (all available dates):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dt[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(GHCN_Tmin), .(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(GHCN_Tmin, Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pearson"</span>))]</span>
<span id="cb19-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cor)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.9258  0.9258  0.9258  0.9258  0.9258  0.9258 </code></pre>
</div>
</div>
<p>Correlation summary on temperature minima (GHCN below 0°C, all available dates):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dt[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(GHCN_Tmin) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> GHCN_Tmin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, .(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cor</span>(GHCN_Tmin, Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pearson"</span>))]</span>
<span id="cb21-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(tmp<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>cor)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.2952  0.2952  0.2952  0.2952  0.2952  0.2952 </code></pre>
</div>
</div>
<p>ERA5 bias along GHCN ground temperatures:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dt[<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(GHCN_Tmin), .(</span>
<span id="cb23-2">  GHCN_Tmean, GHCN_Tmin, </span>
<span id="cb23-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Tmean_bias =</span> GHCN_Tmean <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Tmean,</span>
<span id="cb23-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Tmin_bias =</span> GHCN_Tmin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> Tmin</span>
<span id="cb23-5">)]</span>
<span id="cb23-6"></span>
<span id="cb23-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gglabs</span>(tmp) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>GHCN_Tmean, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Tmean_bias, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bias (Tmean)"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x=</span>GHCN_Tmin, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y=</span>Tmin_bias, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Bias (Tmin)"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span>pal2) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n.breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n.breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GHCN Temp. (°C)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 Bias (°C)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 Temperature Bias vs. GHCN WS (2010-2020)"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="frost-index" class="level1">
<h1>Frost Index</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">degree_frost <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb24-2"></span>
<span id="cb24-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add daily index values</span></span>
<span id="cb24-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">setorder</span>(dt, loc_id, date)</span>
<span id="cb24-5">idx <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> dt[<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(date) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%between%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">yday</span>(prd), .(</span>
<span id="cb24-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">idx =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(degree_frost[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmin</span>(</span>
<span id="cb24-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fifelse</span>(Tmin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> degree_frost[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], degree_frost[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], Tmin), degree_frost[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T),</span>
<span id="cb24-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">idx_ghcn =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(degree_frost[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmin</span>(</span>
<span id="cb24-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fifelse</span>(GHCN_Tmin <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> degree_frost[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], degree_frost[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], GHCN_Tmin), degree_frost[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)</span>
<span id="cb24-10">), by<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(loc_id, year)]</span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">melt</span>(idx, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">id.vars=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"loc_id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>))</span>
<span id="cb25-2">tmp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> tmp[, .(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na.rm=</span>T)), by<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span>.(year, variable)]</span>
<span id="cb25-3"></span>
<span id="cb25-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gglabs</span>(tmp[variable <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"idx"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"idx_ghcn"</span>)], </span>
<span id="cb25-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(year, value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill=</span>variable)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodge"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"light"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_discrete</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span>pal2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GHCN FDD"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 FDD"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">breaks=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2010</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2020</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean FDD across Stations -- ERA5 vs. GHCN (2010-2020)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb25-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>))</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gglabs</span>(idx[idx_ghcn<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(idx_ghcn, idx)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 non-adjusted"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"+"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color=</span>pal[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dark"</span>], <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_color_discrete</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type=</span>pal2[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GHCN FDD"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ERA5 FDD"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb26-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggtitle</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FDD -- ERA5 vs. GHCN (2010-2020)"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://mbacou.com/posts/2020-12-02-era5-ca/index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{bacou2020,
  author = {BACOU, Melanie},
  title = {ERA5-LAND {Temperature} {Validation} {(California)}},
  date = {2020-12-02},
  url = {https://mbacou.com/posts/2020-12-02-era5-ca},
  langid = {en}
}
</code></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-bacou2020" class="csl-entry quarto-appendix-citeas">
BACOU, Melanie. 2020. <span>“ERA5-LAND Temperature Validation
(California).”</span> December 2, 2020. <a href="https://mbacou.com/posts/2020-12-02-era5-ca">https://mbacou.com/posts/2020-12-02-era5-ca</a>.
</div></div></section></div> ]]></description>
  <category>meteo</category>
  <category>risk modeling</category>
  <guid>https://mbacou.com/posts/2020-12-02-era5-ca/</guid>
  <pubDate>Wed, 02 Dec 2020 00:00:00 GMT</pubDate>
</item>
</channel>
</rss>
