{
  "hash": "9e1700c579a5c74c5adf3b0ba3cec983",
  "result": {
    "markdown": "---\ntitle: ERA5-LAND Temperature Validation (California)\ndescription: |\n  Can we justify winter Y2017 corrections to ERA5-LAND temperature grids over central \n  California?\ndate: 2020-12-02\ndraft: false\nfreeze: true\ncategories:\n  - risk modeling\n---\n\n\n- Can we justify Y2017 correction to ERA5 grids over OLAM portfolio?\n- Portfolio-wide ERA5-LAND temperature validation against NOAA GHCN ground records\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\nlibrary(knitr)\n## Error in fun(pkgname, pkgpath) : could not find function \"fun\"\n## Error in fun(pkgname, pkgpath) : could not find function \"fun\"\n## Error in fun(pkgname, pkgpath) : could not find function \"fun\"\n## Error in fun(pkgname, pkgpath) : could not find function \"fun\"\n## Error in fun(pkgname, pkgpath) : could not find function \"fun\"\n## Error in fun(pkgname, pkgpath) : could not find function \"fun\"\n## Error in fun(pkgname, pkgpath) : could not find function \"fun\"\n## Error in fun(pkgname, pkgpath) : could not find function \"fun\"\n## Error in fun(pkgname, pkgpath) : could not find function \"fun\"\n## Error in fun(pkgname, pkgpath) : could not find function \"fun\"\n## Error in fun(pkgname, pkgpath) : could not find function \"fun\"\nlibrary(lubridate)\n## \n## Attaching package: 'lubridate'\n## The following objects are masked from 'package:base':\n## \n##     date, intersect, setdiff, union\nlibrary(ggplot2)\nlibrary(raster)\n## Loading required package: sp\nlibrary(scales)\nlibrary(data.table)\n## \n## Attaching package: 'data.table'\n## The following object is masked from 'package:raster':\n## \n##     shift\n## The following objects are masked from 'package:lubridate':\n## \n##     hour, isoweek, mday, minute, month, quarter, second, wday, week, yday,\n##     year\nlibrary(zoo)\n## \n## Attaching package: 'zoo'\n## The following objects are masked from 'package:base':\n## \n##     as.Date, as.Date.numeric\nlibrary(rgdal)\n## Please note that rgdal will be retired by the end of 2023,\n## plan transition to sf/stars/terra functions using GDAL and PROJ\n## at your earliest convenience.\n## \n## rgdal: version: 1.5-29, (SVN revision 1165M)\n## Geospatial Data Abstraction Library extensions to R successfully loaded\n## Loaded GDAL runtime: GDAL 3.4.3, released 2022/04/22\n## Path to GDAL shared files: /usr/share/gdal\n## GDAL binary built with GEOS: TRUE \n## Loaded PROJ runtime: Rel. 8.2.0, November 1st, 2021, [PJ_VERSION: 820]\n## Path to PROJ shared files: /home/mbacou/.local/share/proj:/usr/share/proj\n## PROJ CDN enabled: FALSE\n## Linking to sp version:1.4-6\n## To mute warnings of possible GDAL/OSR exportToProj4() degradation,\n## use options(\"rgdal_show_exportToProj4_warnings\"=\"none\") before loading sp or rgdal.\nlibrary(rgeos)\n## Warning in fun(libname, pkgname): rgeos: versions of GEOS runtime 3.10.2-CAPI-1.16.0\n## and GEOS at installation 3.10.1-CAPI-1.16.0differ\n## rgeos version: 0.5-9, (SVN revision 684)\n##  GEOS runtime version: 3.10.2-CAPI-1.16.0 \n##  Please note that rgeos will be retired by the end of 2023,\n## plan transition to sf functions using GEOS at your earliest convenience.\n##  GEOS using OverlayNG\n##  Linking to sp version: 1.4-6 \n##  Polygon checking: TRUE\nlibrary(rnoaa)\n\ndir <- \".\"\nload(file.path(dir, \"./tmp/2020-burn_olam_usa_07.RData\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clear workspace, keep portfolio details\nload(file.path(dir, \"./tmp/2020-burn_olam_usa_06.RData\"))\nrm(list=setdiff(ls(), c(\"dir\", \"pts.dt\", \"dt.era\", \"dt.imp\")))\n\npts <- SpatialPointsDataFrame(pts.dt[, .(X,Y)], data.frame(pts.dt), \n  proj4string=CRS(\"+init=epsg:4326\"))\n\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get GHCN ground obs across ZOI\nstations <- ghcnd_stations()\nsetDT(stations)\nvars <- c(\"PRCP\", \"TAVG\", \"TMAX\", \"TMIN\")\nstations[element %in% vars, .N, by=element]\nstations <- stations[state==\"CA\" & element %in% vars]\n\n# Convert to spatial\nstations.sp <- SpatialPointsDataFrame(stations[, .(longitude, latitude)], stations,\n  proj4string=CRS(\"+init=epsg:4326\"))\n\n# Keep only stations within 30 km of any OLAM site\npts <- spTransform(pts, CRS(\"+init=epsg:3310\"))\nstations.sp <- spTransform(stations.sp, CRS(\"+init=epsg:3310\"))\ndist <- rgeos::gWithinDistance(stations.sp, pts, dist=30*1000, byid=TRUE)\ndist <- colSums(dist)\nnames(dist) <- stations.sp$id\ndist <- dist[dist>0]\nids <- names(dist)\n\npts <- spTransform(pts, CRS(\"+init=epsg:4326\"))\nstations.sp <- spTransform(stations.sp, CRS(\"+init=epsg:4326\"))\n\nplot(extent(pts), lty=2, col=NA, xlab=NA, ylab=NA)\nplot(stations.sp[stations.sp$id %in% ids,], col=\"black\", add=T)\nplot(pts, col=\"blue\", pch=\"*\", add=T)\n\nids <- stations[id %in% ids & element %in% vars & last_year > 2009, unique(id)]\nstations[id %in% ids & element %in% vars]\n\n# Get daily station time-series for the 29 selected\n# Request seems to time out when too large so batch it\nstations.dt <- lapply(ids, function(x) \n  try(ghcnd_search(x, var=vars, date_min=\"2010-01-01\", refresh=T)))\nstations.dt <- stations.dt[sapply(stations.dt, function(x) class(x)!=\"try-error\")]\nstations.dt <- do.call(c, stations.dt)\nstations.dt <- lapply(stations.dt, function(x) setnames(x, 2, \"value\"))\nstations.dt <- rbindlist(stations.dt, idcol=\"var\")\n\nstations.dt[, .N, by=var]\npar(mfrow=c(2,2))\nfor(i in stations.dt[, unique(var)]) stations.dt[var==i, hist(value, main=i)]\npar(mfrow=c(1,1))\n\n# Convert tenths of degrees Celsius to °C\nstations.dt[, value := as.numeric(value)\n][var %in% tolower(vars[2:4]), value := value/10]\n\nids <- stations.dt[, unique(id)]\n\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extract ERA5 at stations' coordinates\nx <- c(\"2010-01-01\", \"2020-07-31\")\ncat <- wc_catalog(x, code=\"era5_temp_h_usa_ca\")\ndt <- wc_extract(\n  stations[id %in% ids, .N, by=.(loc_id=id, X=longitude, Y=latitude)][, N:=NULL], \n  catalog=cat)\n\n# Verify sequence\ndt[c(1, .N), .(date, time)]\ndt[, .N, by=.(y=year(date), loc_id)][N!=8760 & N!=8784 & N!=5112]\n# => OK\n\ndt[,\n  # Apply timezone\n  time := with_tz(as.POSIXct(paste(date, time, sep=\" \")), tzone=\"America/Los_Angeles\")\n][, `:=`(\n  # Convert to IDate\n  date = as.IDate(time),\n  time = as.ITime(time)\n)]\n\n# Verify\ndt[c(1, .N), .(date, time)]\ndt[, .N, by=loc_id][, uniqueN(N)]\ndt[, hist(value)]\ndt[, summary(value)]\n#   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n# -6.623  10.852  17.053  17.939  24.544  43.893  \n\n# Daily\ndt <- dt[, .(\n  Tmean = mean(value, na.rm=T),\n  Tmin = min(value, na.rm=T),\n  Tmax = max(value, na.rm=T)\n), keyby=.(loc_id, date)]\n\n# Combine with GHCN\ntmp <- dcast(stations.dt, id+date~var, value.var=\"value\")\ndt[tmp, on=.(loc_id=id, date=date), `:=`(\n  GHCN_Tmean = i.tavg,\n  GHCN_Tmin = i.tmin,\n  GHCN_Tmax = i.tmax\n)]\n\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(x, i, j, t, tmp)\nsave.image(file.path(dir, \"./tmp/2020-burn_olam_usa_07.RData\"))\n\n```\n:::\n\n\n\n# Results\n\n10-year comparisons between ERA5-LAND and GHCN station network over Feb-March risk period. 11 stations (under 30-km from production sites and with daily temperature records after 2010) are selected for the comparison.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(cat[date==\"2020-02-01\", crop(raster(file, 1), stations.sp[stations.sp$id %in% ids,])], \n  xlab=NA, ylab=NA, main=\"Tmean °C\", sub=\"ERA5 2020-02-01 00:00\")\n## Loading required namespace: ncdf4\nplot(crop(stations.sp[!stations.sp$id %in% ids,], pts), col=\"black\", add=T)\nplot(stations.sp[stations.sp$id %in% ids,], col=\"red\", add=T)\nplot(pts, col=\"blue\", pch=\"*\", add=T)\nplot(pts[pts$loc_id==25,], col=\"blue\", pch=1, cex=2, add=T)\nlegend(\"bottomleft\", \n  legend=c(\"GHCN station\", \"GHCN station ≤ 30-km\", \"OLAM production site\", \"Main site\"),\n  col=c(\"black\", \"red\", \"blue\", \"blue\"), pch=c(\"+\", \"+\", \"*\", \"o\"), cex=.7)\n## Warning in (function (s, units = \"user\", cex = NULL, font = NULL, vfont = NULL, :\n## conversion failure on 'GHCN station ≤ 30-km' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in (function (s, units = \"user\", cex = NULL, font = NULL, vfont = NULL, :\n## conversion failure on 'GHCN station ≤ 30-km' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in (function (s, units = \"user\", cex = NULL, font = NULL, vfont = NULL, :\n## conversion failure on 'GHCN station ≤ 30-km' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in text.default(x, y, ...): conversion failure on 'GHCN station ≤ 30-km' in\n## 'mbcsToSbcs': dot substituted for <e2>\n## Warning in text.default(x, y, ...): conversion failure on 'GHCN station ≤ 30-km' in\n## 'mbcsToSbcs': dot substituted for <89>\n## Warning in text.default(x, y, ...): conversion failure on 'GHCN station ≤ 30-km' in\n## 'mbcsToSbcs': dot substituted for <a4>\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/preview-1.svg){width=672}\n:::\n:::\n\n\nList of GHCN stations retained in the analysis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\nkable(stations[id %in% ids & element %in% c(\"TMIN\", \"TAVG\"), .(\n  first_year, last_year\n), keyby=.(id, name, element)]\n)\n```\n\n::: {.cell-output-display}\n|id          |name                      |element | first_year| last_year|\n|:-----------|:-------------------------|:-------|----------:|---------:|\n|USC00040444 |BAKERSFIELD 5 NW          |TMIN    |       1999|      2020|\n|USC00045233 |MADERA                    |TMIN    |       1928|      2020|\n|USC00045532 |MERCED                    |TMIN    |       1899|      2020|\n|USC00048122 |SHAFTER 6E                |TMIN    |       2009|      2020|\n|USC00048752 |TAFT                      |TMIN    |       1994|      2011|\n|USR0000CCAT |CATHEYS VALLEY CALIFORNIA |TAVG    |       1999|      2020|\n|USR0000CCAT |CATHEYS VALLEY CALIFORNIA |TMIN    |       1999|      2020|\n|USR0000CGSP |GREEN SPRING CALIFORNIA   |TAVG    |       1990|      2020|\n|USR0000CGSP |GREEN SPRING CALIFORNIA   |TMIN    |       1990|      2020|\n|USW00023155 |BAKERSFIELD AP            |TAVG    |       1998|      2020|\n|USW00023155 |BAKERSFIELD AP            |TMIN    |       1937|      2020|\n|USW00023257 |MERCED MUNI AP            |TAVG    |       1998|      2005|\n|USW00023257 |MERCED MUNI AP            |TMIN    |       1998|      2020|\n|USW00023258 |MODESTO CITY CO AP        |TAVG    |       1998|      2005|\n|USW00023258 |MODESTO CITY CO AP        |TMIN    |       1927|      2020|\n|USW00093242 |MADERA MUNI AP            |TAVG    |       1998|      2005|\n|USW00093242 |MADERA MUNI AP            |TMIN    |       1998|      2020|\n:::\n:::\n\n\n10-year summary.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\npar(mfrow=c(2,2))\nfor(i in stations.dt[, unique(var)]) stations.dt[var==i, hist(value, main=i)]\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.svg){width=672}\n:::\n:::\n\n\n# Temperature Minima\n\n2010-2014\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprd <- c(\"2020-02-01\", \"2020-03-31\")\ndt[, sdate := as.Date(date)][, year := year(date)]\nyear(dt$sdate) <- 2020\n\ntmp <- dt[yday(date) %between% yday(prd), .(\n  Tmin = mean(Tmin, na.rm=T),\n  GHCN_Tmin = mean(GHCN_Tmin, na.rm=T),\n  diff_Tmean = mean(Tmean - GHCN_Tmean, na.rm=T),\n  diff_Tmin = mean(Tmin - GHCN_Tmin, na.rm=T)\n), by=.(year, date, sdate)\n][, sign := diff_Tmin > 0]\n\nggplot(tmp[year(date) %between% c(2010, 2014)], aes(x=sdate)) +\n  geom_line(aes(y=Tmin, color=\"ERA5 Tmin\")) + \n  geom_point(aes(y=Tmin, color=\"ERA5 Tmin\"), size=.5) +\n  geom_line(aes(y=GHCN_Tmin, color=\"GHCN Tmin\")) + \n  geom_point(aes(y=GHCN_Tmin, color=\"GHCN Tmin\"), size=.5) +\n  scale_x_date(date_labels=\"%b-%d\", breaks=\"2 days\") +\n  scale_color_discrete(NULL) +\n  facet_wrap(\"year\", ncol=1) +\n  xlab(NULL) +\n  ggtitle(\"Temperature Mean of Min -- ERA5 vs. GHCN (19 WS)\") +\n  theme(\n    legend.position=\"top\", legend.justification=0, \n    axis.text.x=element_text(angle=-90)\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.svg){width=672}\n:::\n:::\n\n\n2015-2020\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tmp[year(date) > 2014], aes(x=sdate)) +\n  geom_line(aes(y=Tmin, color=\"ERA5 Tmin\")) + \n  geom_point(aes(y=Tmin, color=\"ERA5 Tmin\"), size=.5) +\n  geom_line(aes(y=GHCN_Tmin, color=\"GHCN Tmin\")) + \n  geom_point(aes(y=GHCN_Tmin, color=\"GHCN Tmin\"), size=.5) +\n  scale_x_date(date_labels=\"%b-%d\", breaks=\"2 days\") +\n  scale_color_discrete(NULL) +\n  facet_wrap(\"year\", ncol=1) +\n  xlab(NULL) +\n  ggtitle(\"Temperature Mean of Min -- ERA5 vs. GHCN (19 WS)\") +\n  theme(\n    legend.position=\"top\", legend.justification=0, \n    axis.text.x=element_text(angle=-90)\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.svg){width=672}\n:::\n:::\n\n\n2010-2014\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tmp[year(date) %between% c(2010, 2014)], \n  aes(sdate, color=sign)) +\n  geom_segment(aes(xend=sdate, y=Tmin, yend=GHCN_Tmin), size=.8, lineend=\"butt\") +\n  geom_point(aes(y=GHCN_Tmin)) +\n  scale_x_date(date_labels=\"%b-%d\", breaks=\"3 day\") +\n  scale_color_discrete(NULL, labels=c(\"ERA5 ≤ GHCN\", \"ERA5 > GHCN\")) +\n  facet_wrap(\"year\", ncol=1) +\n  xlab(NULL) +\n  ggtitle(\"Temperature Mean of Min -- ERA5 vs. GHCN WS\") +\n  theme(\n    legend.position=\"top\", legend.justification=0, \n    axis.text.x=element_text(angle=-90)\n  )\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :\n## conversion failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :\n## conversion failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :\n## conversion failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.svg){width=672}\n:::\n:::\n\n\n2015-2020\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(tmp[year(date) > 2014], \n  aes(sdate, color=sign)) +\n  geom_segment(aes(xend=sdate, y=Tmin, yend=GHCN_Tmin), size=.8, lineend=\"butt\") +\n  geom_point(aes(y=GHCN_Tmin)) +\n  scale_x_date(date_labels=\"%b-%d\", breaks=\"3 day\") +\n  scale_color_discrete(NULL, labels=c(\"ERA5 ≤ GHCN\", \"ERA5 > GHCN\")) +\n  facet_wrap(\"year\", ncol=1) +\n  xlab(NULL) +\n  ggtitle(\"Temperature Mean of Min -- ERA5 vs. GHCN WS\") +\n  theme(\n    legend.position=\"top\", legend.justification=0, \n    axis.text.x=element_text(angle=-90)\n  )\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call(C_textBounds, as.graphicsAnnot(x$label), x$x, x$y, : conversion\n## failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :\n## conversion failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <e2>\n## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :\n## conversion failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <89>\n## Warning in grid.Call.graphics(C_text, as.graphicsAnnot(x$label), x$x, x$y, :\n## conversion failure on 'ERA5 ≤ GHCN' in 'mbcsToSbcs': dot substituted for <a4>\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.svg){width=672}\n:::\n:::\n\n\nDifferences between ERA5 Tmin and GHCN Tmin over risk period:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt[yday(date) %in% yday(prd), summary(Tmin - GHCN_Tmin)]\n##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n## -5.9080 -1.1880  0.2500  0.2953  1.5979  9.7133     206\n```\n:::\n\n\nDifferences between ERA5 Tmin and GHCN Tmin over risk period (GHCN below 0°C):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt[yday(date) %in% yday(prd) & GHCN_Tmin <= 0, summary(Tmin - GHCN_Tmin)]\n##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n##   1.364   1.822   2.350   2.058   2.350   2.405\n```\n:::\n\n\nDifferences between ERA5 Tmean and GHCN Tmean over risk period:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt[yday(date) %in% yday(prd), summary(Tmean - GHCN_Tmean)]\n##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n## -4.5485 -1.7915 -1.1321 -0.9827 -0.1575  1.9854     359\n```\n:::\n\n\nDifferences between ERA5 Tmax and GHCN Tmax over risk period:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndt[yday(date) %in% yday(prd), summary(Tmax - GHCN_Tmax)]\n##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n## -4.6174 -1.4994 -0.6568 -0.6119  0.1649  4.7969     204\n```\n:::\n\n\nCorrelation summary on temperature minima (all available dates):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmp <- dt[!is.na(GHCN_Tmin), .(cor = cor(GHCN_Tmin, Tmin, method=\"pearson\"))]\nsummary(tmp$cor)\n##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n##  0.9258  0.9258  0.9258  0.9258  0.9258  0.9258\n```\n:::\n\n\nCorrelation summary on temperature minima (GHCN below 0°C, all available dates):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmp <- dt[!is.na(GHCN_Tmin) & GHCN_Tmin <= 0, .(cor = cor(GHCN_Tmin, Tmin, method=\"pearson\"))]\nsummary(tmp$cor)\n##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n##  0.2952  0.2952  0.2952  0.2952  0.2952  0.2952\n```\n:::\n\n\nERA5 bias along GHCN ground temperatures:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\ntmp <- dt[!is.na(GHCN_Tmin), .(\n  GHCN_Tmean, GHCN_Tmin, \n  Tmean_bias = GHCN_Tmean - Tmean,\n  Tmin_bias = GHCN_Tmin - Tmin\n)]\n\nggplot(tmp) +\n  geom_smooth(aes(x=GHCN_Tmean, y=Tmean_bias, color=\"Bias (Tmean)\")) +\n  geom_smooth(aes(x=GHCN_Tmin, y=Tmin_bias, color=\"Bias (Tmin)\")) +\n  geom_hline(aes(yintercept=0), color=\"black\", linetype=1) +\n  geom_vline(aes(xintercept=0), color=\"black\", linetype=3) +\n  scale_color_discrete(NULL) +\n  scale_x_continuous(n.breaks=10) +\n  scale_y_continuous(n.breaks=10) +\n  xlab(\"GHCN Temp. (°C)\") + ylab(\"ERA5 Bias (°C)\") +\n  ggtitle(\"ERA5 Bias vs. GHCN WS (2010-2020)\") +\n  theme(\n    legend.position=\"top\", legend.justification=0\n  )\n## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = \"cs\")'\n## Warning: Removed 27289 rows containing non-finite values (stat_smooth).\n## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = \"cs\")'\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.svg){width=672}\n:::\n:::\n\n\n\n# Frost Index\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\ndegree_frost <- c(-4, 0)\n\n# Add daily index values\nsetorder(dt, loc_id, date)\nidx <- dt[yday(date) %between% yday(prd), .(\n  idx = sum(degree_frost[2] - pmin(\n    fifelse(Tmin < degree_frost[1], degree_frost[1], Tmin), degree_frost[2]), na.rm=T),\n  idx_ghcn = sum(degree_frost[2] - pmin(\n    fifelse(GHCN_Tmin < degree_frost[1], degree_frost[1], GHCN_Tmin), degree_frost[2]), na.rm=T)\n), by=.(loc_id, year)]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n\ntmp <- melt(idx, id.vars=c(\"loc_id\", \"year\"))\ntmp <- tmp[, .(value=mean(value, na.rm=T)), by=.(year, variable)]\n\nggplot(tmp[variable %in% c(\"idx\", \"idx_ghcn\")], \n  aes(year, value, fill=variable)) +\n  geom_col(position=\"dodge\", color=NA, alpha=.8, width=.8) +\n  scale_fill_discrete(NULL, labels=c(\"GHCN FDD\", \"ERA5 FDD\")) +\n  scale_x_continuous(breaks=2010:2020) +\n  xlab(NULL) + ylab(NULL) +\n  ggtitle(\"Mean FDD across Stations -- ERA5 vs. GHCN (2010-2020)\") +\n  theme(\n    axis.text.x=element_text(angle=-90),\n    legend.position=\"top\", legend.justification=0\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.svg){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n\nggplot(idx[idx_ghcn>0], aes(idx_ghcn, idx)) +\n  geom_abline(linetype=3) +\n  geom_smooth(aes(color=\"ERA5 non-adjusted\")) +\n  geom_point(shape=\"+\", size=4) +\n  scale_color_discrete(NULL) +\n  xlab(\"GHCN FDD\") + ylab(\"ERA5 FDD\") +\n  ggtitle(\"FDD -- ERA5 vs. GHCN (2010-2020)\") +\n  theme(\n    legend.position=\"top\", legend.justification=0\n  )\n## `geom_smooth()` using method = 'loess' and formula 'y ~ x'\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.svg){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}